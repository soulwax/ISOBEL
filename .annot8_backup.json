{
  "timestamp": "2026-01-17T19:32:42.493880",
  "files": {
    "ecosystem.config.cjs": "/* File: ecosystem.config.cjs */\n\n/**\n * PM2 Ecosystem Configuration\n * \n * Usage:\n *   - Production: pm2 start ecosystem.config.cjs --env production\n *   - Staging: pm2 start ecosystem.config.cjs --env staging\n *   - Development: pm2 start ecosystem.config.cjs --env development\n * \n * Or use npm scripts:\n *   - npm run pm2:start:prod\n *   - npm run pm2:start:staging\n *   - npm run pm2:start:dev\n */\n\nmodule.exports = {\n  apps: [\n    {\n      name: 'isobel',\n      script: 'dist/scripts/migrate-and-start.js',\n      interpreter: 'node',\n      interpreter_args: '--enable-source-maps',\n      \n      // Process management\n      instances: 1,\n      exec_mode: 'fork', // Use 'cluster' for multi-core scaling\n      \n      // Restart behavior\n      autorestart: true,\n      watch: false, // Set to true for development auto-reload\n      ignore_watch: [\n        'node_modules',\n        'logs',\n        'data',\n        '.git',\n        'dist',\n        '*.log',\n      ],\n      max_memory_restart: '1G',\n      min_uptime: '10s', // Minimum uptime before considering app stable\n      max_restarts: 10, // Max restarts within restart_delay\n      restart_delay: 4000, // Delay between restarts (ms)\n      \n      // Logging\n      error_file: './logs/pm2-error.log',\n      out_file: './logs/pm2-out.log',\n      log_file: './logs/pm2-combined.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n      time: true,\n      merge_logs: true,\n      log_type: 'json', // JSON format for better parsing\n      combine_logs: true,\n      \n      // Node.js options\n      node_args: '--enable-source-maps',\n      \n      // Environment variables\n      env: {\n        NODE_ENV: 'development',\n      },\n      env_development: {\n        NODE_ENV: 'development',\n        DEBUG: 'isobel:*',\n      },\n      env_staging: {\n        NODE_ENV: 'staging',\n      },\n      env_production: {\n        NODE_ENV: 'production',\n      },\n      \n      // Monitoring & Health checks\n      pmx: true, // Enable PM2 monitoring\n      listen_timeout: 10000, // Time to wait for app to listen (ms)\n      kill_timeout: 5000, // Time to wait for graceful shutdown (ms)\n      \n      // Advanced options\n      instance_var: 'INSTANCE_ID', // Environment variable for instance ID\n      wait_ready: false, // Wait for 'ready' event from app\n      shutdown_with_message: false, // Graceful shutdown on SIGINT/SIGTERM\n      \n      // Source map support\n      source_map_support: true,\n    },\n  ],\n  \n  // Deployment configuration (optional)\n  deploy: {\n    production: {\n      user: 'node',\n      host: ['your-server.com'],\n      ref: 'origin/main',\n      repo: 'git@github.com:soulwax/ISOBEL.git',\n      path: '/var/www/isobel',\n      'post-deploy': 'npm install && npm run build && pm2 reload ecosystem.config.cjs --env production',\n      'pre-setup': '',\n    },\n  },\n};\n",
    ".github/nginx-file.sh": "sudo tee /etc/nginx/sites-available/isobel.battlecry.tech.conf > /dev/null << 'EOF'\nserver {\n    server_name isobel.battlecry.tech;\n    access_log /var/log/nginx/reverse-access.log;\n    error_log /var/log/nginx/reverse-error.log;\n\n    # Proxy API requests to the auth server\n    location /api/ {\n        proxy_pass http://127.0.0.1:3003;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # Serve frontend from Vite\n    location / {\n        proxy_pass http://127.0.0.1 :3001;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\n    listen [::]:443 ssl; # managed by Certbot\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/isobel.battlecry.tech/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/isobel.battlecry.tech/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n}\nserver {\n    if ($host = isobel.battlecry.tech) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n\n    server_name isobel.battlecry.tech;\n    listen 80;\n    listen [::]:80;\n    return 404; # managed by Certbot\n\n\n}\nEOF",
    ".gitignore": "# File: .gitignore\n\ndata\n.DS_Store\ndist\ndts\n\n# Logs\nlogs\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\nlerna-debug.log*\n\n# Diagnostic reports (https://nodejs.org/api/report.html)\nreport.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json\n\n# Runtime data\npids\n*.pid\n*.seed\n*.pid.lock\n\n# Directory for instrumented libs generated by jscoverage/JSCover\nlib-cov\n\n# Coverage directory used by tools like istanbul\ncoverage\n*.lcov\n\n# nyc test coverage\n.nyc_output\n\n# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)\n.grunt\n\n# Bower dependency directory (https://bower.io/)\nbower_components\n\n# node-waf configuration\n.lock-wscript\n\n# Compiled binary addons (https://nodejs.org/api/addons.html)\nbuild/Release\n\n# Dependency directories\nnode_modules/\njspm_packages/\n\n# TypeScript v1 declaration files\ntypings/\n\n# TypeScript cache\n*.tsbuildinfo\n\n# Optional npm cache directory\n.npm\n\n# Optional eslint cache\n.eslintcache\n\n# Microbundle cache\n.rpt2_cache/\n.rts2_cache_cjs/\n.rts2_cache_es/\n.rts2_cache_umd/\n\n# Optional REPL history\n.node_repl_history\n\n# Output of 'npm pack'\n*.tgz\n\n# Yarn Integrity file\n.yarn-integrity\n\n# dotenv environment variables file\n.env\n.env.test\n\n# parcel-bundler cache (https://parceljs.org/)\n.cache\n\n# Next.js build output\n.next\n\n# Nuxt.js build / generate output\n.nuxt\ndist\n\n# Gatsby files\n.cache/\n# Comment in the public line in if your project uses Gatsby and *not* Next.js\n# https://nextjs.org/blog/next-9-1#public-directory-support\n# public\n\n# vuepress build output\n.vuepress/dist\n\n# Serverless directories\n.serverless/\n\n# FuseBox cache\n.fusebox/\n\n# DynamoDB Local files\n.dynamodb/\n\n# TernJS port file\n.tern-port",
    "web/.gitignore": "# File: .gitignore\n\n# Logs\nlogs\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\npnpm-debug.log*\nlerna-debug.log*\n\nnode_modules\ndist\ndist-ssr\nbuild\n*.local\n.vercel\n\n# TypeScript compiled output (should not be emitted, but just in case)\nsrc/**/*.js\nsrc/**/*.js.map\n\n# Editor directories and files\n.vscode/*\n!.vscode/extensions.json\n.idea\n.DS_Store\n*.suo\n*.ntvs*\n*.njsproj\n*.sln\n*.sw?\n\n\nweb\n\n.env\n.env.local\n.env.*.local\n.env.production\n.env.production.local\n.env.test\n.env.test.local\n.env.development.local\n.env.development\n.env.staging\n.env.staging.local\n.env.testing\n.env.testing.local\n\n.github/docs/*.md",
    "web/env.d.ts": "/// <reference types=\"vite/client\" />\n\ninterface ImportMetaEnv {\n  readonly VITE_BOT_HEALTH_URL?: string;\n  readonly VITE_API_URL?: string;\n}\n\ninterface ImportMeta {\n  readonly env: ImportMetaEnv;\n}\n",
    "web/.env": "# File: .env\n# ISOBEL/web/.env\n\n# Server configuration\nPORT=3001\n\n# Discord OAuth credentials\nDISCORD_CLIENT_ID=1445978496219217932\nDISCORD_CLIENT_SECRET=\"zt-GN1fxovZ8m61uWlHIC0Za1bHRC8gL\"\n\n# NextAuth configuration\nNEXTAUTH_SECRET=\"ywxQHTqiiDcdf1dhyDZOTnd8F7ctXRZNbnAgTcZUtYY=\"\nNEXTAUTH_URL=\"https://isobel.soulwax.dev\"\nVITE_AUTH_API_URL=\"https://isobel.soulwax.dev\"\n\n# Discord OAuth URL\nDISCORD_GENERATED_URL=\"https://discord.com/oauth2/authorize?client_id=1445978496219217932&response_type=code&redirect_uri=https%3A%2F%2Fisobel.soulwax.dev%2Fapi%2Fauth%2Fcallback%2Fdiscord&scope=email+identify+guilds\"\n\n# Internal service endpoints\nBOT_HEALTH_URL=\"https://isobelhealth.soulwax.dev/\"\n\n# Database connection (recommended pooled connection)\nDATABASE_URL=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require\n\n# Database connection without pgbouncer\nDATABASE_URL_UNPOOLED=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require\n\n# Parameters for Vercel Postgres Templates\nPOSTGRES_URL=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require\nPOSTGRES_URL_NON_POOLING=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require\nPOSTGRES_USER=neondb_owner\nPOSTGRES_HOST=ep-polished-bush-agyzq26s-pooler.c-2.eu-central-1.aws.neon.tech\nPOSTGRES_PASSWORD=npg_qLR0AMHXu8IV\nPOSTGRES_DATABASE=neondb\nPOSTGRES_URL_NO_SSL=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s-pooler.c-2.eu-central-1.aws.neon.tech/neondb\nPOSTGRES_PRISMA_URL=postgresql://neondb_owner:npg_qLR0AMHXu8IV@ep-polished-bush-agyzq26s-pooler.c-2.eu-central-1.aws.neon.tech/neondb?connect_timeout=15&sslmode=require\n\n\n",
    "web/vite.config.js": "// File: vite.config.ts\nimport react from '@vitejs/plugin-react';\nimport { defineConfig } from 'vite';\n// https://vite.dev/config/\nexport default defineConfig({\n    plugins: [react()],\n    build: {\n        outDir: './build',\n        emptyOutDir: true,\n    },\n    server: {\n        host: '0.0.0.0', // Listen on all interfaces\n        port: 3001,\n        allowedHosts: ['echo.soulwax.dev', 'localhost', 'isobel.battlecry.tech', 'isobel.soulwax.dev'],\n        proxy: {\n            '/api': {\n                target: process.env.VITE_AUTH_API_URL || 'http://localhost:3003',\n                changeOrigin: true,\n                secure: false,\n                ws: true,\n            },\n        },\n    },\n    preview: {\n        host: '0.0.0.0', // Listen on all interfaces for production\n        port: 3001,\n        proxy: {\n            '/api': {\n                target: process.env.VITE_AUTH_API_URL || 'http://localhost:3003',\n                changeOrigin: true,\n                secure: false,\n                ws: true,\n            },\n        },\n    },\n});\n",
    "web/vite.config.ts": "// File: vite.config.ts\n\nimport react from '@vitejs/plugin-react'\nimport { defineConfig } from 'vite'\n\n// https://vite.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  build: {\n    outDir: './build',\n    emptyOutDir: true,\n  },\n  server: {\n    host: '0.0.0.0', // Listen on all interfaces\n    port: parseInt(process.env.PORT || '3001', 10),\n    allowedHosts: ['echo.soulwax.dev', 'localhost', 'isobel.battlecry.tech', 'isobel.soulwax.dev'],\n    proxy: {\n      '/api': {\n        target: process.env.VITE_AUTH_API_URL || 'http://localhost:3003',\n        changeOrigin: true,\n        secure: false,\n        ws: true,\n        configure: (proxy, _options) => {\n          proxy.on('error', (err, _req, _res) => {\n            console.log('proxy error', err);\n          });\n          proxy.on('proxyReq', (_proxyReq, req, _res) => {\n            console.log('Proxying:', req.method, req.url, '-> target:', process.env.VITE_AUTH_API_URL || 'http://localhost:3003');\n          });\n        },\n      },\n    },\n  },\n  preview: {\n    host: '0.0.0.0', // Listen on all interfaces for production\n    port: parseInt(process.env.PORT || '3001', 10),\n    proxy: {\n      '/api': {\n        target: process.env.VITE_AUTH_API_URL || 'http://localhost:3003',\n        changeOrigin: true,\n        secure: false,\n        ws: true,\n      },\n    },\n  },\n})\n",
    "web/src/db/schema.ts": "// File: src/db/schema.ts\n\nimport { relations } from 'drizzle-orm';\nimport { boolean, index, integer, pgTable, primaryKey, text, timestamp } from 'drizzle-orm/pg-core';\n\n// NextAuth required tables\nexport const users = pgTable('user', {\n  id: text('id').primaryKey(),\n  name: text('name'),\n  email: text('email'),\n  emailVerified: timestamp('emailVerified', { mode: 'date' }),\n  image: text('image'),\n  createdAt: timestamp('createdAt', { mode: 'date' }).notNull().defaultNow(),\n  updatedAt: timestamp('updatedAt', { mode: 'date' }).notNull().defaultNow(),\n});\n\nexport const accounts = pgTable('account', {\n  userId: text('userId')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' }),\n  type: text('type').notNull(),\n  provider: text('provider').notNull(),\n  providerAccountId: text('providerAccountId').notNull(),\n  refresh_token: text('refresh_token'),\n  access_token: text('access_token'),\n  expires_at: integer('expires_at'),\n  token_type: text('token_type'),\n  scope: text('scope'),\n  id_token: text('id_token'),\n  session_state: text('session_state'),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.provider, table.providerAccountId] }),\n  userIdIdx: index('account_user_id_idx').on(table.userId),\n}));\n\nexport const sessions = pgTable('session', {\n  sessionToken: text('sessionToken').primaryKey(),\n  userId: text('userId')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' }),\n  expires: timestamp('expires', { mode: 'date' }).notNull(),\n}, (table) => ({\n  userIdIdx: index('session_user_id_idx').on(table.userId),\n}));\n\nexport const verificationTokens = pgTable('verificationToken', {\n  identifier: text('identifier').notNull(),\n  token: text('token').notNull(),\n  expires: timestamp('expires', { mode: 'date' }).notNull(),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.identifier, table.token] }),\n}));\n\n// Discord-specific tables\nexport const discordUsers = pgTable('discord_user', {\n  id: text('id').primaryKey(), // Discord user ID\n  userId: text('userId')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' })\n    .unique(), // Link to NextAuth user\n  username: text('username').notNull(),\n  discriminator: text('discriminator'), // Legacy discriminator (may be null for new users)\n  globalName: text('globalName'), // New username system\n  avatar: text('avatar'),\n  bot: boolean('bot').notNull().default(false),\n  system: boolean('system').notNull().default(false),\n  mfaEnabled: boolean('mfaEnabled').notNull().default(false),\n  banner: text('banner'),\n  accentColor: integer('accentColor'),\n  locale: text('locale'),\n  verified: boolean('verified').notNull().default(false),\n  email: text('email'),\n  flags: integer('flags'),\n  premiumType: integer('premiumType'),\n  publicFlags: integer('publicFlags'),\n  createdAt: timestamp('createdAt', { mode: 'date' }).notNull().defaultNow(),\n  updatedAt: timestamp('updatedAt', { mode: 'date' }).notNull().defaultNow(),\n}, (table) => ({\n  userIdIdx: index('discord_user_user_id_idx').on(table.userId),\n}));\n\nexport const discordGuilds = pgTable('discord_guild', {\n  id: text('id').primaryKey(), // Discord guild ID\n  name: text('name').notNull(),\n  icon: text('icon'),\n  iconHash: text('iconHash'),\n  splash: text('splash'),\n  discoverySplash: text('discoverySplash'),\n  ownerId: text('ownerId').notNull(), // Discord user ID of owner\n  owner: boolean('owner').notNull().default(false), // Whether the bot is the owner\n  permissions: text('permissions'), // Bitwise permissions as string\n  region: text('region'),\n  afkChannelId: text('afkChannelId'),\n  afkTimeout: integer('afkTimeout'),\n  widgetEnabled: boolean('widgetEnabled'),\n  widgetChannelId: text('widgetChannelId'),\n  verificationLevel: integer('verificationLevel'),\n  defaultMessageNotifications: integer('defaultMessageNotifications'),\n  explicitContentFilter: integer('explicitContentFilter'),\n  roles: text('roles'), // JSON array of role IDs\n  emojis: text('emojis'), // JSON array of emoji data\n  features: text('features'), // JSON array of guild features\n  mfaLevel: integer('mfaLevel'),\n  applicationId: text('applicationId'),\n  systemChannelId: text('systemChannelId'),\n  systemChannelFlags: integer('systemChannelFlags'),\n  rulesChannelId: text('rulesChannelId'),\n  maxMembers: integer('maxMembers'),\n  maxPresences: integer('maxPresences'),\n  vanityUrlCode: text('vanityUrlCode'),\n  description: text('description'),\n  banner: text('banner'),\n  premiumTier: integer('premiumTier'),\n  premiumSubscriptionCount: integer('premiumSubscriptionCount'),\n  preferredLocale: text('preferredLocale'),\n  publicUpdatesChannelId: text('publicUpdatesChannelId'),\n  maxVideoChannelUsers: integer('maxVideoChannelUsers'),\n  maxStageVideoChannelUsers: integer('maxStageVideoChannelUsers'),\n  approximateMemberCount: integer('approximateMemberCount'),\n  approximatePresenceCount: integer('approximatePresenceCount'),\n  nsfwLevel: integer('nsfwLevel'),\n  joinedAt: timestamp('joinedAt', { mode: 'date' }), // When bot joined\n  createdAt: timestamp('createdAt', { mode: 'date' }).notNull().defaultNow(),\n  updatedAt: timestamp('updatedAt', { mode: 'date' }).notNull().defaultNow(),\n});\n\n// Guild members (users in guilds)\nexport const guildMembers = pgTable('guild_member', {\n  id: text('id').primaryKey(), // Composite: guildId_userId\n  guildId: text('guildId')\n    .notNull()\n    .references(() => discordGuilds.id, { onDelete: 'cascade' }),\n  userId: text('userId')\n    .notNull()\n    .references(() => discordUsers.id, { onDelete: 'cascade' }),\n  nick: text('nick'),\n  avatar: text('avatar'),\n  roles: text('roles').notNull().default('[]'), // JSON array of role IDs\n  joinedAt: timestamp('joinedAt', { mode: 'date' }),\n  premiumSince: timestamp('premiumSince', { mode: 'date' }),\n  deaf: boolean('deaf').notNull().default(false),\n  mute: boolean('mute').notNull().default(false),\n  pending: boolean('pending'),\n  permissions: text('permissions'), // Computed permissions as string\n  communicationDisabledUntil: timestamp('communicationDisabledUntil', { mode: 'date' }),\n  createdAt: timestamp('createdAt', { mode: 'date' }).notNull().defaultNow(),\n  updatedAt: timestamp('updatedAt', { mode: 'date' }).notNull().defaultNow(),\n}, (table) => ({\n  // Indexes for frequently queried columns\n  guildIdIdx: index('guild_member_guild_id_idx').on(table.guildId),\n  userIdIdx: index('guild_member_user_id_idx').on(table.userId),\n  // Composite index for common query pattern (guildId + userId)\n  compositeIdx: index('guild_member_composite_idx').on(table.guildId, table.userId),\n}));\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  accounts: many(accounts),\n  sessions: many(sessions),\n  discordUser: one(discordUsers),\n}));\n\nexport const accountsRelations = relations(accounts, ({ one }) => ({\n  user: one(users, { fields: [accounts.userId], references: [users.id] }),\n}));\n\nexport const sessionsRelations = relations(sessions, ({ one }) => ({\n  user: one(users, { fields: [sessions.userId], references: [users.id] }),\n}));\n\nexport const discordUsersRelations = relations(discordUsers, ({ one, many }) => ({\n  user: one(users, { fields: [discordUsers.userId], references: [users.id] }),\n  guildMembers: many(guildMembers),\n}));\n\nexport const discordGuildsRelations = relations(discordGuilds, ({ many }) => ({\n  members: many(guildMembers),\n}));\n\n// Bot settings per guild (matches BOT schema.prisma)\nexport const settings = pgTable('setting', {\n  guildId: text('guildId').primaryKey().references(() => discordGuilds.id, { onDelete: 'cascade' }),\n  playlistLimit: integer('playlistLimit').notNull().default(50),\n  secondsToWaitAfterQueueEmpties: integer('secondsToWaitAfterQueueEmpties').notNull().default(30),\n  leaveIfNoListeners: boolean('leaveIfNoListeners').notNull().default(true),\n  queueAddResponseEphemeral: boolean('queueAddResponseEphemeral').notNull().default(false),\n  autoAnnounceNextSong: boolean('autoAnnounceNextSong').notNull().default(false),\n  defaultVolume: integer('defaultVolume').notNull().default(100),\n  defaultQueuePageSize: integer('defaultQueuePageSize').notNull().default(10),\n  turnDownVolumeWhenPeopleSpeak: boolean('turnDownVolumeWhenPeopleSpeak').notNull().default(false),\n  turnDownVolumeWhenPeopleSpeakTarget: integer('turnDownVolumeWhenPeopleSpeakTarget').notNull().default(20),\n  createdAt: timestamp('createdAt', { mode: 'date' }).notNull().defaultNow(),\n  updatedAt: timestamp('updatedAt', { mode: 'date' }).notNull().defaultNow(),\n});\n\nexport const guildMembersRelations = relations(guildMembers, ({ one }) => ({\n  guild: one(discordGuilds, { fields: [guildMembers.guildId], references: [discordGuilds.id] }),\n  user: one(discordUsers, { fields: [guildMembers.userId], references: [discordUsers.id] }),\n}));\n\nexport const discordGuildsSettingsRelations = relations(discordGuilds, ({ one }) => ({\n  settings: one(settings, { fields: [discordGuilds.id], references: [settings.guildId] }),\n}));\n",
    "web/src/db/index.ts": "// File: src/db/index.ts\n\n// Load environment variables if not already loaded (safeguard for ES module loading order)\nimport { config } from 'dotenv';\nconfig();\n\nimport { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from './schema.js';\nimport { getEnv } from '../lib/env.js';\n\n// Get database URL from environment\nconst databaseUrl = getEnv('DATABASE_URL', getEnv('POSTGRES_URL', ''));\n\nif (!databaseUrl) {\n  throw new Error('DATABASE_URL or POSTGRES_URL environment variable is required');\n}\n\n// Create postgres connection\n// Use connection pooling for better performance\n// For serverless (Vercel), consider using a connection pooler like Neon's built-in pooling\nconst client = postgres(databaseUrl, {\n  max: process.env.VERCEL ? 1 : 10, // Serverless: 1 connection per function instance\n  idle_timeout: 20, // Close idle connections after 20 seconds\n  connect_timeout: 10, // Connection timeout in seconds\n  // For serverless, connections are short-lived, so we don't need a large pool\n});\n\nexport const db = drizzle(client, { schema });\n\nexport type Database = typeof db;\n",
    "web/src/index.css": "/* File: src/index.css */\n\n:root {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  line-height: 1.5;\n  font-weight: 400;\n\n  color-scheme: dark;\n  color: rgba(255, 255, 255, 0.87);\n  background-color: #1E2124;\n\n  font-synthesis: none;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nhtml {\n  scroll-behavior: smooth;\n}\n\nbody {\n  margin: 0;\n  min-width: 320px;\n  min-height: 100vh;\n  overflow-x: hidden;\n}\n\n#root {\n  min-height: 100vh;\n}\n\n/* Selection styling */\n::selection {\n  background-color: rgba(88, 101, 242, 0.3);\n  color: var(--text-primary);\n}\n\n::-moz-selection {\n  background-color: rgba(88, 101, 242, 0.3);\n  color: var(--text-primary);\n}\n\n/* Scrollbar styling */\n::-webkit-scrollbar {\n  width: 12px;\n  height: 12px;\n}\n\n::-webkit-scrollbar-track {\n  background: var(--discord-darkest);\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--discord-dark);\n  border-radius: 6px;\n  border: 2px solid var(--discord-darkest);\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: var(--border-color);\n}\n",
    "web/src/App.css": "/* File: src/App.css */\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\n:root {\n  --discord-blurple: #5865F2;\n  --discord-blurple-hover: #4752C4;\n  --discord-dark: #2C2F33;\n  --discord-darker: #23272A;\n  --discord-darkest: #1E2124;\n  --text-primary: #FFFFFF;\n  --text-secondary: #B9BBBE;\n  --text-muted: #72767D;\n  --border-color: #40444B;\n  --card-bg: #2F3136;\n  --gradient-start: #5865F2;\n  --gradient-end: #EB459E;\n}\n\nhtml {\n  scroll-behavior: smooth;\n}\n\nbody {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background-color: var(--discord-darkest);\n  color: var(--text-primary);\n  line-height: 1.6;\n}\n\n.app {\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  margin-left: 240px; /* Offset for sidebar */\n}\n\n@media (max-width: 768px) {\n  .app {\n    margin-left: 0; /* No offset on mobile */\n  }\n}\n\n/* Navigation */\n.nav {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  background-color: rgba(30, 33, 36, 0.85);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border-bottom: 1px solid var(--border-color);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n@media (max-width: 768px) {\n  .nav {\n    /* No changes needed for mobile */\n  }\n}\n\n.nav-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 1rem 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.logo {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--text-primary);\n  transition: transform 0.2s ease;\n}\n\n.logo:hover {\n  transform: scale(1.05);\n}\n\n.logo-icon {\n  font-size: 2rem;\n  width: 2rem;\n  height: 2rem;\n  color: var(--text-primary);\n  flex-shrink: 0;\n}\n\n.nav-links {\n  display: flex;\n  gap: 2rem;\n  align-items: center;\n}\n\n.nav-links a {\n  color: var(--text-secondary);\n  text-decoration: none;\n  font-weight: 500;\n  transition: color 0.2s;\n  position: relative;\n}\n\n.nav-links a:hover {\n  color: var(--text-primary);\n}\n\n.nav-links a:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 4px;\n  border-radius: 2px;\n}\n\n.github-link {\n  padding: 0.5rem 1rem;\n  background-color: var(--discord-blurple);\n  border-radius: 4px;\n  color: var(--text-primary) !important;\n  transition: all 0.2s;\n}\n\n.github-link:hover {\n  background-color: var(--discord-blurple-hover);\n  color: var(--text-primary) !important;\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.3);\n}\n\n.github-link:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n/* Hero Section */\n.hero {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 4rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 3rem;\n  align-items: center;\n  min-height: 80vh;\n  position: relative;\n}\n\n.hero::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100%;\n  max-width: 800px;\n  height: 100%;\n  background: radial-gradient(circle at center, rgba(88, 101, 242, 0.1) 0%, transparent 70%);\n  pointer-events: none;\n  z-index: 0;\n}\n\n.hero > * {\n  position: relative;\n  z-index: 1;\n}\n\n.hero-top {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n}\n\n.hero-image {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.songbird-img {\n  max-width: 400px;\n  width: 100%;\n  height: auto;\n  object-fit: contain;\n  filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));\n  transition: transform 0.3s ease, filter 0.3s ease;\n}\n\n.songbird-img:hover {\n  transform: scale(1.05);\n  filter: drop-shadow(0 12px 24px rgba(88, 101, 242, 0.3));\n}\n\n.hero-bottom {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 4rem;\n  align-items: center;\n  width: 100%;\n}\n\n.hero-content {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n.hero-title-section {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 1.5rem;\n  margin-bottom: 1rem;\n}\n\n.hero-title {\n  font-size: 3.5rem;\n  font-weight: 800;\n  line-height: 1.1;\n  color: var(--text-primary);\n  margin: 0;\n}\n\n.highlight {\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.hero-subtitle {\n  font-size: 1.25rem;\n  color: var(--text-secondary);\n  line-height: 1.6;\n}\n\n.hero-buttons {\n  display: flex;\n  gap: 1rem;\n  margin-top: 1rem;\n}\n\n.btn {\n  padding: 0.875rem 2rem;\n  border-radius: 4px;\n  text-decoration: none;\n  font-weight: 600;\n  transition: all 0.2s;\n  display: inline-block;\n  font-family: inherit;\n  cursor: pointer;\n  border: none;\n}\n\n.btn-primary {\n  background-color: var(--discord-blurple);\n  color: var(--text-primary);\n}\n\n.btn-primary:hover {\n  background-color: var(--discord-blurple-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4);\n}\n\n.btn-primary:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4), 0 0 0 4px rgba(88, 101, 242, 0.1);\n}\n\n.btn-secondary {\n  background-color: transparent;\n  color: var(--text-primary);\n  border: 2px solid var(--border-color);\n}\n\n.btn-secondary:hover {\n  border-color: var(--discord-blurple);\n  color: var(--discord-blurple);\n  transform: translateY(-2px);\n}\n\n.btn-secondary:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n/* Discord Mockup */\n.hero-visual {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.discord-mockup {\n  background-color: var(--card-bg);\n  border-radius: 8px;\n  overflow: hidden;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px var(--border-color);\n  width: 100%;\n  max-width: 400px;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.discord-mockup:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--discord-blurple);\n}\n\n.mockup-header {\n  background-color: var(--discord-darker);\n  padding: 0.75rem 1rem;\n  display: flex;\n  gap: 0.5rem;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.mockup-dot {\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: var(--text-muted);\n}\n\n.mockup-content {\n  padding: 1rem;\n}\n\n.mockup-message {\n  display: flex;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n\n.mockup-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  flex-shrink: 0;\n}\n\n.mockup-text {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.mockup-username {\n  font-weight: 600;\n  color: var(--text-primary);\n}\n\n.mockup-time {\n  font-size: 0.75rem;\n  color: var(--text-muted);\n}\n\n.mockup-embed {\n  background-color: var(--discord-darker);\n  border-left: 4px solid var(--discord-blurple);\n  border-radius: 4px;\n  padding: 1rem;\n  margin-left: 3rem;\n  transition: all 0.3s ease;\n}\n\n.discord-mockup:hover .mockup-embed {\n  border-left-color: var(--gradient-end);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.2);\n}\n\n.embed-title {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: var(--text-primary);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.inline-icon {\n  width: 1.25rem;\n  height: 1.25rem;\n  color: var(--text-primary);\n  flex-shrink: 0;\n}\n\n.embed-description {\n  color: var(--text-secondary);\n  font-size: 0.9rem;\n  margin-bottom: 0.75rem;\n}\n\n.embed-progress {\n  margin-top: 0.75rem;\n}\n\n.progress-bar {\n  height: 4px;\n  background: linear-gradient(90deg, var(--discord-blurple), var(--gradient-end));\n  border-radius: 2px;\n  width: 60%;\n  animation: progress 2s ease-in-out infinite;\n  position: relative;\n  overflow: hidden;\n}\n\n.progress-bar::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(\n    90deg,\n    transparent,\n    rgba(255, 255, 255, 0.3),\n    transparent\n  );\n  animation: shimmer 2s infinite;\n}\n\n@keyframes progress {\n  0%, 100% {\n    width: 60%;\n  }\n  50% {\n    width: 85%;\n  }\n}\n\n@keyframes shimmer {\n  0% {\n    transform: translateX(-100%);\n  }\n  100% {\n    transform: translateX(100%);\n  }\n}\n\n/* Features Section */\n.features {\n  padding: 6rem 2rem;\n  background-color: var(--discord-dark);\n  position: relative;\n}\n\n.features::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--border-color), transparent);\n}\n\n.container {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.section-title {\n  font-size: 2.5rem;\n  font-weight: 700;\n  text-align: center;\n  margin-bottom: 1rem;\n  color: var(--text-primary);\n  position: relative;\n  display: inline-block;\n  width: 100%;\n}\n\n.section-title::after {\n  content: '';\n  position: absolute;\n  bottom: -0.5rem;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 60px;\n  height: 3px;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  border-radius: 2px;\n}\n\n.section-subtitle {\n  text-align: center;\n  color: var(--text-secondary);\n  font-size: 1.125rem;\n  margin-bottom: 3rem;\n  line-height: 1.6;\n}\n\n.features-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 2rem;\n  margin-top: 3rem;\n}\n\n.feature-card {\n  background-color: var(--card-bg);\n  padding: 2rem;\n  border-radius: 8px;\n  border: 1px solid var(--border-color);\n  transition: all 0.3s ease;\n  position: relative;\n  overflow: hidden;\n}\n\n.feature-card::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 3px;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  transform: scaleX(0);\n  transform-origin: left;\n  transition: transform 0.3s ease;\n}\n\n.feature-card:hover::before {\n  transform: scaleX(1);\n}\n\n.feature-card:hover {\n  transform: translateY(-4px);\n  border-color: var(--discord-blurple);\n  box-shadow: 0 8px 24px rgba(88, 101, 242, 0.2);\n}\n\n.feature-icon {\n  font-size: 2.5rem;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--discord-blurple);\n  transition: transform 0.3s ease;\n}\n\n.feature-icon svg {\n  width: 2.5rem;\n  height: 2.5rem;\n}\n\n.feature-card:hover .feature-icon {\n  transform: scale(1.1) rotate(5deg);\n}\n\n.feature-title {\n  font-size: 1.25rem;\n  font-weight: 600;\n  margin-bottom: 0.75rem;\n  color: var(--text-primary);\n}\n\n.feature-description {\n  color: var(--text-secondary);\n  line-height: 1.6;\n}\n\n/* About Section */\n.about {\n  padding: 6rem 2rem;\n  background-color: var(--discord-darkest);\n  position: relative;\n}\n\n.about::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--border-color), transparent);\n}\n\n.about-content {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.about-text p {\n  font-size: 1.125rem;\n  color: var(--text-secondary);\n  margin-bottom: 1.5rem;\n  line-height: 1.8;\n}\n\n.about-text p:first-of-type {\n  font-size: 1.25rem;\n  color: var(--text-primary);\n  font-weight: 500;\n}\n\n.about-stats {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 2rem;\n  margin-top: 3rem;\n  padding-top: 3rem;\n  border-top: 1px solid var(--border-color);\n}\n\n.stat {\n  text-align: center;\n  padding: 1rem;\n  border-radius: 8px;\n  transition: all 0.3s ease;\n}\n\n.stat:hover {\n  background-color: rgba(88, 101, 242, 0.05);\n  transform: translateY(-4px);\n}\n\n.stat-number {\n  font-size: 2.5rem;\n  font-weight: 700;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  margin-bottom: 0.5rem;\n  transition: transform 0.3s ease;\n}\n\n.stat:hover .stat-number {\n  transform: scale(1.1);\n}\n\n.stat-label {\n  color: var(--text-secondary);\n  font-size: 0.9rem;\n}\n\n/* Footer */\n.footer {\n  background-color: var(--discord-darker);\n  border-top: 1px solid var(--border-color);\n  padding: 2rem;\n  margin-top: auto;\n  position: relative;\n}\n\n.footer::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--border-color), transparent);\n}\n\n.footer-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.footer-logo {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--text-primary);\n  transition: transform 0.2s ease;\n}\n\n.footer-logo:hover {\n  transform: scale(1.05);\n}\n\n.footer-links {\n  display: flex;\n  gap: 2rem;\n}\n\n.footer-links a {\n  color: var(--text-secondary);\n  text-decoration: none;\n  transition: color 0.2s;\n  position: relative;\n}\n\n.footer-links a:hover {\n  color: var(--text-primary);\n}\n\n.footer-links a:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 4px;\n  border-radius: 2px;\n}\n\n.footer-bottom {\n  max-width: 1200px;\n  margin: 0 auto;\n  text-align: center;\n  padding-top: 1rem;\n  border-top: 1px solid var(--border-color);\n  color: var(--text-muted);\n  font-size: 0.875rem;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .hero {\n    padding: 2rem 1rem;\n    text-align: center;\n  }\n\n  .hero-bottom {\n    grid-template-columns: 1fr;\n    gap: 2rem;\n  }\n\n  .hero-title-section {\n    align-items: center;\n    text-align: center;\n  }\n\n  .songbird-img {\n    max-width: 100%;\n  }\n\n  .hero-title {\n    font-size: 2.5rem;\n  }\n\n  .hero-buttons {\n    flex-direction: column;\n    width: 100%;\n  }\n\n  .hero-buttons .btn {\n    width: 100%;\n    text-align: center;\n  }\n\n  .nav-container {\n    padding: 1rem;\n    flex-wrap: wrap;\n  }\n\n  .nav-links {\n    gap: 0.75rem;\n    font-size: 0.875rem;\n    flex-wrap: wrap;\n  }\n\n  .features-grid {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n  }\n\n  .features {\n    padding: 4rem 1rem;\n  }\n\n  .about {\n    padding: 4rem 1rem;\n  }\n\n  .footer-content {\n    flex-direction: column;\n    gap: 1rem;\n    text-align: center;\n  }\n\n  .about-stats {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n  }\n\n  .section-title {\n    font-size: 2rem;\n  }\n\n  .section-subtitle {\n    font-size: 1rem;\n  }\n}\n\n@media (max-width: 480px) {\n  .hero-title {\n    font-size: 2rem;\n  }\n\n  .section-title {\n    font-size: 1.75rem;\n  }\n\n  .hero-subtitle {\n    font-size: 1rem;\n  }\n\n  .feature-card {\n    padding: 1.5rem;\n  }\n\n  .nav-links {\n    gap: 0.5rem;\n    font-size: 0.8rem;\n  }\n\n  .logo {\n    font-size: 1.25rem;\n  }\n\n  .logo-icon {\n    font-size: 1.5rem;\n    width: 1.5rem;\n    height: 1.5rem;\n  }\n}\n",
    "web/src/server/app.ts": "// File: src/server/app.ts\n// Express app factory - can be used for both PM2 and Vercel\n\n// IMPORTANT: Load environment variables FIRST, before any other imports\nimport { config } from 'dotenv';\nconfig();\n\nimport { and, eq } from \"drizzle-orm\";\nimport express from \"express\";\nimport rateLimit from \"express-rate-limit\";\nimport helmet from \"helmet\";\nimport { handlers } from \"../auth/index.js\";\nimport { db } from \"../db/index.js\";\nimport {\n  discordGuilds,\n  discordUsers,\n  guildMembers,\n  settings,\n} from \"../db/schema.js\";\nimport { getEnv, validateEnv } from \"../lib/env.js\";\nimport { AuthorizationError, NotFoundError } from \"../lib/errors.js\";\nimport { logger } from \"../lib/logger.js\";\nimport { canManageGuildSettings, validateGuildId } from \"../lib/utils.js\";\nimport { guildSettingsSchema } from \"../lib/validation.js\";\nimport { AuthenticatedRequest, errorHandler, requireAuth } from \"./middleware.js\";\n\n// Validate environment variables at startup (only in non-Vercel environments)\nif (process.env.VERCEL !== '1') {\n  try {\n    validateEnv();\n  } catch (error) {\n    logger.error(\"Environment validation failed\", { error });\n    // Don't exit in Vercel environment\n    if (process.env.VERCEL !== '1') {\n      process.exit(1);\n    }\n  }\n}\n\nexport function createApp() {\n  const app = express();\n  const FRONTEND_URL = getEnv(\"NEXTAUTH_URL\", \"http://localhost:3001\");\n\n  // Security headers\n  app.use(helmet({\n    contentSecurityPolicy: {\n      directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\", \"'unsafe-inline'\"], // Minimize unsafe-inline in production\n        styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n        imgSrc: [\"'self'\", \"https://cdn.discordapp.com\", \"data:\"],\n      },\n    },\n  }));\n\n  // Request size limits\n  app.use(express.json({ limit: '10kb' }));\n  app.use(express.urlencoded({ extended: true, limit: '10kb' }));\n\n  // Rate limiting (use memory store for Vercel)\n  const apiLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100, // Limit each IP to 100 requests per windowMs\n    message: 'Too many requests from this IP, please try again later.',\n    standardHeaders: true,\n    legacyHeaders: false,\n    store: process.env.VERCEL ? undefined : undefined, // Use default memory store\n  });\n\n  const authLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000,\n    max: 5, // Stricter for auth endpoints\n    message: 'Too many authentication requests, please try again later.',\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  // CORS middleware - improved security\n  app.use((req, res, next): void => {\n    const origin = req.headers.origin;\n    \n    // Define allowed origins based on environment\n    const allowedOrigins = process.env.NODE_ENV === 'production'\n      ? [FRONTEND_URL] // Strict in production\n      : [\n          FRONTEND_URL,\n          \"http://localhost:3001\",\n          \"http://localhost:3000\",\n          \"http://127.0.0.1:3001\",\n          \"http://127.0.0.1:3000\",\n        ];\n    \n    // In development, be more permissive: allow any localhost origin or requests without origin\n    if (process.env.NODE_ENV === \"development\") {\n      if (origin) {\n        // In development, allow any localhost origin (any port)\n        if (origin.startsWith(\"http://localhost:\") || origin.startsWith(\"http://127.0.0.1:\")) {\n          res.header(\"Access-Control-Allow-Origin\", origin);\n        } else if (allowedOrigins.includes(origin)) {\n          res.header(\"Access-Control-Allow-Origin\", origin);\n        } else {\n          // Reject non-localhost origins in development\n          res.status(403).json({ error: \"Origin not allowed\" });\n          return;\n        }\n      } else {\n        // Allow requests without origin in development (e.g., Vite proxy, curl, same-origin)\n        // Set to wildcard for development to allow all proxied requests\n        res.header(\"Access-Control-Allow-Origin\", \"*\");\n      }\n    } else {\n      // Production: strict origin checking\n      if (origin && allowedOrigins.includes(origin)) {\n        res.header(\"Access-Control-Allow-Origin\", origin);\n      } else if (!origin) {\n        // Allow requests without origin (same-origin requests, server-to-server)\n        res.header(\"Access-Control-Allow-Origin\", \"*\");\n      } else {\n        // Reject unknown origins in production\n        res.status(403).json({ error: \"Origin not allowed\" });\n        return;\n      }\n    }\n    \n    res.header(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n    res.header(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n    res.header(\"Access-Control-Allow-Credentials\", \"true\");\n    \n    if (req.method === \"OPTIONS\") {\n      res.sendStatus(200);\n      return;\n    }\n    next();\n  });\n\n  // NextAuth API routes - match all paths starting with /api/auth/\n  app.all(/^\\/api\\/auth\\/.*/, authLimiter, async (req, res): Promise<void> => {\n    try {\n      const { GET, POST } = handlers;\n      const handler = req.method === \"GET\" ? GET : POST;\n\n      if (!handler) {\n        res.status(405).json({ error: \"Method not allowed\" });\n        return;\n      }\n\n      // Build full URL using originalUrl which contains the full path\n      const protocol = req.protocol || \"http\";\n      const host = req.get(\"host\") || \"localhost:3001\";\n      const fullUrl = `${protocol}://${host}${req.originalUrl}`;\n\n      // Convert Express req to Next.js Request\n      const headers = new Headers();\n      Object.entries(req.headers).forEach(([key, value]) => {\n        if (value) {\n          headers.set(key, Array.isArray(value) ? value.join(\", \") : value);\n        }\n      });\n\n      let body: string | undefined;\n      if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n        if (req.is(\"application/json\")) {\n          body = JSON.stringify(req.body);\n        } else if (req.is(\"application/x-www-form-urlencoded\")) {\n          body = new URLSearchParams(\n            req.body as Record<string, string>\n          ).toString();\n        }\n      }\n\n      const nextReq = new Request(fullUrl, {\n        method: req.method,\n        headers,\n        body,\n      }) as Parameters<typeof handler>[0];\n\n      const nextRes = await handler(nextReq);\n\n      // Convert Next.js Response to Express response\n      const bodyText = await nextRes.text();\n      res.status(nextRes.status);\n\n      // Copy headers, handling Set-Cookie specially\n      nextRes.headers.forEach((value: string, key: string) => {\n        if (key.toLowerCase() === \"set-cookie\") {\n          // Set-Cookie headers need special handling\n          const cookies = nextRes.headers.getSetCookie();\n          cookies.forEach((cookie: string) => {\n            res.append(\"Set-Cookie\", cookie);\n          });\n        } else {\n          res.setHeader(key, value);\n        }\n      });\n\n      res.send(bodyText);\n    } catch (error) {\n      logger.error(\"Auth handler error\", { error, path: req.path });\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // API endpoint to get user's Discord guilds\n  app.get(\"/api/guilds\", apiLimiter, requireAuth, async (req, res): Promise<void> => {\n    try {\n      const session = (req as AuthenticatedRequest).session;\n      if (!session?.user?.id) {\n        res.status(401).json({ error: \"Unauthorized\" });\n        return;\n      }\n\n      // Get Discord user ID\n      const discordUser = await db\n        .select()\n        .from(discordUsers)\n        .where(eq(discordUsers.userId, session.user.id))\n        .limit(1);\n\n      if (discordUser.length === 0) {\n        res.json({ guilds: [] });\n        return;\n      }\n\n      const discordUserId = discordUser[0].id;\n\n      // Get all guilds the user is a member of\n      const userGuilds = await db\n        .select({\n          id: discordGuilds.id,\n          name: discordGuilds.name,\n          icon: discordGuilds.icon,\n          permissions: guildMembers.permissions,\n        })\n        .from(guildMembers)\n        .innerJoin(discordGuilds, eq(guildMembers.guildId, discordGuilds.id))\n        .where(eq(guildMembers.userId, discordUserId));\n\n      res.json({ guilds: userGuilds });\n    } catch (error) {\n      logger.error(\"Error fetching guilds\", { error, userId: (req as AuthenticatedRequest).session?.user?.id });\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // API endpoint to get guild settings\n  app.get(\"/api/guilds/:guildId/settings\", apiLimiter, requireAuth, async (req, res): Promise<void> => {\n    try {\n      const guildId = req.params.guildId as string;\n\n      // Validate guild ID format\n      if (!validateGuildId(guildId)) {\n        res.status(400).json({ error: \"Invalid guild ID format\" });\n        return;\n      }\n\n      const session = (req as AuthenticatedRequest).session;\n      if (!session?.user?.id) {\n        res.status(401).json({ error: \"Unauthorized\" });\n        return;\n      }\n\n      // Verify user is a member of this guild\n      const discordUser = await db\n        .select()\n        .from(discordUsers)\n        .where(eq(discordUsers.userId, session.user.id))\n        .limit(1);\n\n      if (discordUser.length === 0) {\n        res.status(403).json({ error: \"Forbidden\" });\n        return;\n      }\n\n      const member = await db\n        .select()\n        .from(guildMembers)\n        .where(\n          and(\n            eq(guildMembers.guildId, guildId),\n            eq(guildMembers.userId, discordUser[0].id)\n          )\n        )\n        .limit(1);\n\n      if (member.length === 0) {\n        res.status(403).json({ error: \"You are not a member of this server\" });\n        return;\n      }\n\n      // Get or create default settings\n      let guildSettings = await db\n        .select()\n        .from(settings)\n        .where(eq(settings.guildId, guildId))\n        .limit(1);\n\n      if (guildSettings.length === 0) {\n        // Create default settings and return them directly\n        const inserted = await db.insert(settings).values({ guildId }).returning();\n        guildSettings = inserted;\n      }\n\n      if (guildSettings.length === 0) {\n        throw new NotFoundError(\"Failed to retrieve guild settings\");\n      }\n\n      res.json({ settings: guildSettings[0] });\n    } catch (error) {\n      if (error instanceof NotFoundError) {\n        res.status(404).json({ error: error.message });\n        return;\n      }\n      logger.error(\"Error fetching guild settings\", { error, guildId: req.params.guildId });\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // API endpoint to update guild settings\n  app.post(\"/api/guilds/:guildId/settings\", apiLimiter, requireAuth, async (req, res): Promise<void> => {\n    try {\n      const guildId = req.params.guildId as string;\n\n      // Validate guild ID format\n      if (!validateGuildId(guildId)) {\n        res.status(400).json({ error: \"Invalid guild ID format\" });\n        return;\n      }\n\n      // Validate request body\n      const validationResult = guildSettingsSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        res.status(400).json({ \n          error: \"Invalid settings data\", \n          details: validationResult.error.errors \n        });\n        return;\n      }\n\n      const updates = validationResult.data;\n\n      const session = (req as AuthenticatedRequest).session;\n      if (!session?.user?.id) {\n        res.status(401).json({ error: \"Unauthorized\" });\n        return;\n      }\n\n      // Verify user is a member of this guild\n      const discordUser = await db\n        .select()\n        .from(discordUsers)\n        .where(eq(discordUsers.userId, session.user.id))\n        .limit(1);\n\n      if (discordUser.length === 0) {\n        res.status(403).json({ error: \"Forbidden\" });\n        return;\n      }\n\n      const member = await db\n        .select()\n        .from(guildMembers)\n        .where(\n          and(\n            eq(guildMembers.guildId, guildId),\n            eq(guildMembers.userId, discordUser[0].id)\n          )\n        )\n        .limit(1);\n\n      if (member.length === 0) {\n        res.status(403).json({ error: \"You are not a member of this server\" });\n        return;\n      }\n\n      // Check if user has permission to manage guild settings\n      if (!canManageGuildSettings(member[0].permissions)) {\n        throw new AuthorizationError(\"You do not have permission to modify settings\");\n      }\n\n      // Check if settings exist, create if not\n      const existing = await db\n        .select()\n        .from(settings)\n        .where(eq(settings.guildId, guildId))\n        .limit(1);\n\n      if (existing.length === 0) {\n        await db.insert(settings).values({ guildId });\n      }\n\n      // Update settings\n      await db\n        .update(settings)\n        .set({\n          ...updates,\n          updatedAt: new Date(),\n        })\n        .where(eq(settings.guildId, guildId));\n\n      // Return updated settings\n      const updated = await db\n        .select()\n        .from(settings)\n        .where(eq(settings.guildId, guildId))\n        .limit(1);\n\n      if (updated.length === 0) {\n        throw new NotFoundError(\"Failed to retrieve updated settings\");\n      }\n\n      res.json({ settings: updated[0] });\n    } catch (error) {\n      if (error instanceof AuthorizationError) {\n        res.status(403).json({ error: error.message });\n        return;\n      }\n      if (error instanceof NotFoundError) {\n        res.status(404).json({ error: error.message });\n        return;\n      }\n      logger.error(\"Error updating guild settings\", { error, guildId: req.params.guildId });\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Health check endpoint - proxies to the bot's health server\n  app.get(\"/api/health\", async (_req, res): Promise<void> => {\n    const botHealthUrl = getEnv(\"BOT_HEALTH_URL\", \"https://isobelhealth.soulwax.dev\");\n    \n    // Normalize URL: handle trailing slash and /health path\n    let healthUrl = botHealthUrl.trim();\n    \n    // If /health is already in the URL, use it as-is\n    if (healthUrl.endsWith('/health')) {\n      // Already has /health, use as-is\n    } else if (healthUrl.endsWith('/')) {\n      // Has trailing slash, append 'health' (no leading slash)\n      healthUrl = `${healthUrl}health`;\n    } else {\n      // No trailing slash, append '/health'\n      healthUrl = `${healthUrl}/health`;\n    }\n\n    try {\n      logger.info(`Fetching bot health from ${healthUrl}`, { \n        botHealthUrl, \n        constructedUrl: healthUrl,\n        envVar: process.env.BOT_HEALTH_URL \n      });\n      \n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => {\n        logger.warn(\"Health check timeout, aborting...\", { url: healthUrl });\n        controller.abort();\n      }, 5000); // 5 second timeout\n\n      const response = await fetch(healthUrl, {\n        signal: controller.signal,\n        headers: {\n          'User-Agent': 'isobel-web/1.0',\n        },\n      });\n      clearTimeout(timeoutId);\n      \n      logger.info(`Bot health response status: ${response.status}`, { \n        url: healthUrl,\n        status: response.status,\n        statusText: response.statusText,\n        headers: Object.fromEntries(response.headers.entries())\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text().catch(() => 'Unable to read error response');\n        logger.warn(`Bot health check failed`, {\n          url: healthUrl,\n          status: response.status,\n          statusText: response.statusText,\n          errorText: errorText.substring(0, 200), // Limit error text length\n        });\n        res.status(response.status).json({\n          status: \"error\",\n          ready: false,\n          error: `Bot health check failed with status ${response.status}: ${response.statusText}`,\n          url: healthUrl,\n        });\n        return;\n      }\n\n      const data = await response.json();\n      logger.debug(`Bot health check successful`, { data });\n      res.json(data);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      const errorName = error instanceof Error ? error.name : 'UnknownError';\n      \n      logger.error(\"Error checking bot health\", { \n        error: errorMessage,\n        errorName,\n        url: healthUrl,\n        botHealthUrl,\n        envVar: process.env.BOT_HEALTH_URL,\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      \n      res.status(503).json({\n        status: \"error\",\n        ready: false,\n        error: `Unable to connect to bot health server: ${errorMessage}`,\n        url: healthUrl,\n        errorName,\n      });\n    }\n  });\n\n  // Web server health check\n  app.get(\"/health\", (_req, res) => {\n    res.json({\n      status: \"ok\",\n      timestamp: new Date().toISOString(),\n      uptime: process.uptime(),\n      service: \"isobel-web\",\n    });\n  });\n\n  // Error handler middleware (must be last)\n  app.use(errorHandler);\n\n  return app;\n}\n",
    "web/src/server/api/auth/[...nextauth]/route.ts": "// File: src/server/api/auth/[...nextauth]/route.ts\n\nimport { handlers } from '../../../../auth';\n\nexport const { GET, POST } = handlers;\n",
    "web/src/server/middleware.ts": "// File: src/server/middleware.ts\n\nimport express from 'express';\nimport { handlers } from '../auth/index.js';\nimport { AuthenticationError, AuthorizationError } from '../lib/errors.js';\nimport { logger } from '../lib/logger.js';\n\n/**\n * Session data attached to Express request\n */\nexport interface AuthenticatedRequest extends express.Request {\n  session?: {\n    user: {\n      id: string;\n      discordId?: string;\n      name?: string;\n      email?: string;\n      image?: string;\n    };\n    expires?: string;\n  };\n}\n\n/**\n * Get session from NextAuth request\n */\nasync function getSessionFromRequest(req: express.Request): Promise<AuthenticatedRequest['session'] | null> {\n  const protocol = req.protocol || 'http';\n  const host = req.get('host') || 'localhost:3001';\n  const fullUrl = `${protocol}://${host}/api/auth/session`;\n\n  const headers = new Headers();\n  Object.entries(req.headers).forEach(([key, value]) => {\n    if (value) {\n      headers.set(key, Array.isArray(value) ? value.join(', ') : value);\n    }\n  });\n\n  const nextReq = new Request(fullUrl, {\n    method: 'GET',\n    headers,\n  }) as Parameters<typeof handlers.GET>[0];\n\n  try {\n    const sessionResponse = await handlers.GET(nextReq);\n    const sessionText = await sessionResponse.text();\n    return sessionText ? JSON.parse(sessionText) : null;\n  } catch (error) {\n    logger.error('Error fetching session', { error });\n    return null;\n  }\n}\n\n/**\n * Middleware to require authentication\n */\nexport async function requireAuth(\n  req: express.Request,\n  res: express.Response,\n  next: express.NextFunction\n): Promise<void> {\n  try {\n    const session = await getSessionFromRequest(req);\n    \n    if (!session?.user?.id) {\n      throw new AuthenticationError('Authentication required');\n    }\n\n    (req as AuthenticatedRequest).session = session;\n    next();\n  } catch (error) {\n    if (error instanceof AuthenticationError) {\n      res.status(401).json({ error: error.message });\n      return;\n    }\n    logger.error('Auth middleware error', { error });\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}\n\n/**\n * Error handler middleware\n */\nexport function errorHandler(\n  error: unknown,\n  req: express.Request,\n  res: express.Response,\n  _next: express.NextFunction\n): void {\n  if (error instanceof AuthenticationError) {\n    res.status(401).json({ error: error.message });\n    return;\n  }\n\n  if (error instanceof AuthorizationError) {\n    res.status(403).json({ error: error.message });\n    return;\n  }\n\n  // Log unexpected errors\n  logger.error('Unhandled error', { error, path: req.path, method: req.method });\n  res.status(500).json({ error: 'Internal server error' });\n}\n",
    "web/src/server/index.ts": "// File: src/server/index.ts\n// PM2 server entry point - starts Express server\n\n// IMPORTANT: Load environment variables FIRST, before any other imports\nimport { config } from 'dotenv';\nconfig();\n\nimport { logger } from \"../lib/logger\";\nimport { validateEnv, getEnv } from \"../lib/env\";\nimport { createApp } from \"./app\";\n\n// Validate environment variables at startup\ntry {\n  validateEnv();\n} catch (error) {\n  logger.error(\"Environment validation failed\", { error });\n  process.exit(1);\n}\n\n// Create Express app\nconst app = createApp();\n\n// Auth server port (defaults to 3003, separate from Vite port 3001)\nconst PORT = getEnv(\"AUTH_PORT\", \"3003\");\n\n// Start server\napp.listen(PORT, () => {\n  logger.info(`Auth server running on http://localhost:${PORT}`);\n});\n",
    "web/src/main.tsx": "// File: src/main.tsx\n\nimport { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\nimport App from './App'\n\ncreateRoot(document.getElementById('root')!).render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n)\n",
    "web/src/App.tsx": "// File: src/App.tsx\n\nimport {\n  HiOutlineCode,\n  HiOutlineExternalLink,\n  HiOutlineFastForward,\n  HiOutlineMusicNote,\n  HiOutlineSave,\n  HiOutlineSpeakerphone,\n  HiOutlineStop,\n  HiOutlineVideoCamera,\n  HiOutlineVolumeUp,\n} from \"react-icons/hi\";\nimport { useState } from \"react\";\nimport \"./App.css\";\nimport HealthIndicator from \"./components/HealthIndicator\";\nimport DiscordLogin from \"./components/DiscordLogin\";\nimport DiscordGuildsSidebar from \"./components/DiscordGuildsSidebar\";\nimport GuildSettings from \"./components/GuildSettings\";\n\ninterface Guild {\n  id: string;\n  name: string;\n  icon: string | null;\n}\n\nfunction App() {\n  const [selectedGuild, setSelectedGuild] = useState<Guild | null>(null);\n\n  const handleGuildSelect = (guild: Guild) => {\n    setSelectedGuild(guild);\n  };\n\n  const handleBack = () => {\n    setSelectedGuild(null);\n  };\n\n  return (\n    <div className=\"app\">\n      <DiscordGuildsSidebar \n        onGuildSelect={handleGuildSelect}\n        selectedGuildId={selectedGuild?.id}\n      />\n      {selectedGuild ? (\n        <GuildSettings guild={selectedGuild} onBack={handleBack} />\n      ) : (\n        <>\n      <nav className=\"nav\">\n        <div className=\"nav-container\">\n          <div className=\"logo\">\n            <HiOutlineSpeakerphone className=\"logo-icon\" />\n            <span className=\"logo-text\">ISOBEL / (formerly ECHO)</span>\n          </div>\n          <div className=\"nav-links\">\n            <HealthIndicator />\n            <a href=\"#features\">Features</a>\n            <a href=\"#about\">About</a>\n            <a\n              href=\"https://songbirdapi.com\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              API\n            </a>\n            <a\n              href=\"https://github.com/soulwax/ISOBEL\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"github-link\"\n            >\n              GitHub\n            </a>\n            <DiscordLogin />\n          </div>\n        </div>\n      </nav>\n\n      <main>\n        <section className=\"hero\">\n          <div className=\"hero-bottom\">\n            <div className=\"hero-content\">\n              <div className=\"hero-title-section\">\n                <img\n                  src=\"/songbird.png\"\n                  alt=\"ISOBEL Songbird\"\n                  className=\"songbird-img\"\n                />\n                <h1 className=\"hero-title\">\n                  A Discord Music Bot\n                  <span className=\"highlight\"> That Doesn't Suck</span>\n                </h1>\n              </div>\n              <p className=\"hero-subtitle\">\n                High-quality audio streaming, smart caching, overall imo, a good\n                experience 10/10. Better than the majority of the other discord\n                music bots but with fewer features yet. Made with love, as is\n                the songbird api that enables the bot's capabilities.\n              </p>\n              <div className=\"hero-buttons\">\n                <a\n                  href=\"https://discord.com/oauth2/authorize\"\n                  className=\"btn btn-primary\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  Add to Discord\n                </a>\n                <a\n                  href=\"https://github.com/soulwax/ISOBEL\"\n                  className=\"btn btn-secondary\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  View on GitHub\n                </a>\n              </div>\n            </div>\n            <div className=\"hero-visual\">\n              <div className=\"discord-mockup\">\n                <div className=\"mockup-header\">\n                  <div className=\"mockup-dot\"></div>\n                  <div className=\"mockup-dot\"></div>\n                  <div className=\"mockup-dot\"></div>\n                </div>\n                <div className=\"mockup-content\">\n                  <div className=\"mockup-message\">\n                    <div className=\"mockup-avatar\"></div>\n                    <div className=\"mockup-text\">\n                      <span className=\"mockup-username\">ISOBEL</span>\n                      <span className=\"mockup-time\">Today at 2:30 PM</span>\n                    </div>\n                  </div>\n                  <div className=\"mockup-embed\">\n                    <div className=\"embed-content\">\n                      <div className=\"embed-title\">\n                        <HiOutlineMusicNote className=\"inline-icon\" /> Now\n                        Playing\n                      </div>\n                      <div className=\"embed-description\">\n                        High-quality audio streaming\n                      </div>\n                      <div className=\"embed-progress\">\n                        <div className=\"progress-bar\"></div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section id=\"features\" className=\"features\">\n          <div className=\"container\">\n            <h2 className=\"section-title\">Powerful Features</h2>\n            <p className=\"section-subtitle\">\n              Everything you need for the perfect music experience\n            </p>\n            <div className=\"features-grid\">\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineMusicNote />\n                </div>\n                <h3 className=\"feature-title\">High-Quality Audio</h3>\n                <p className=\"feature-description\">\n                  320kbps MP3 source with 192kbps Opus output for crystal-clear\n                  sound\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineStop />\n                </div>\n                <h3 className=\"feature-title\">Animated Progress Bar</h3>\n                <p className=\"feature-description\">\n                  Real-time updating progress bar in discord embed lmao\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineVideoCamera />\n                </div>\n                <h3 className=\"feature-title\">Livestream Support</h3>\n                <p className=\"feature-description\">\n                  Stream HLS live audio feeds\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineFastForward />\n                </div>\n                <h3 className=\"feature-title\">Seeking</h3>\n                <p className=\"feature-description\">\n                  Seek to any position within a song instantly\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineSave />\n                </div>\n                <h3 className=\"feature-title\">Advanced Caching</h3>\n                <p className=\"feature-description\">\n                  Local MP3 caching for instant playback and better performance\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineVolumeUp />\n                </div>\n                <h3 className=\"feature-title\">Volume Management</h3>\n                <p className=\"feature-description\">\n                  Normalizes volume across tracks with automatic ducking when\n                  people speak\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineExternalLink />\n                </div>\n                <h3 className=\"feature-title\">Custom Shortcuts</h3>\n                <p className=\"feature-description\">\n                  Users can add custom shortcuts (aliases) for quick access\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineMusicNote />\n                </div>\n                <h3 className=\"feature-title\">Starchild Music API</h3>\n                <p className=\"feature-description\">\n                  Streams directly from the Starchild Music API - no YouTube or\n                  Spotify required\n                </p>\n              </div>\n              <div className=\"feature-card\">\n                <div className=\"feature-icon\">\n                  <HiOutlineCode />\n                </div>\n                <h3 className=\"feature-title\">TypeScript</h3>\n                <p className=\"feature-description\">\n                  Written in TypeScript with full type safety, easily extendable\n                </p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section id=\"about\" className=\"about\">\n          <div className=\"container\">\n            <h2 className=\"section-title\">Self-Hosted & Open Source</h2>\n            <p className=\"section-subtitle\">\n              Take control of your music bot experience\n            </p>\n            <div className=\"about-content\">\n              <div className=\"about-text\">\n                <p>\n                  ISOBEL (formerly ECHO) is a highly-opinionated, self-hosted Discord music bot\n                  designed for small to medium-sized Discord servers. It's built\n                  with TypeScript and focuses on providing a seamless,\n                  high-quality music experience without the bloat.\n                </p>\n                <p>\n                  With advanced caching, smart volume management, and support\n                  for livestreams, ISOBEL delivers everything you need for your\n                  community's music needs.\n                </p>\n                <div className=\"about-stats\">\n                  <div className=\"stat\">\n                    <div className=\"stat-number\">320kbps</div>\n                    <div className=\"stat-label\">Audio Quality</div>\n                  </div>\n                  <div className=\"stat\">\n                    <div className=\"stat-number\">2GB+</div>\n                    <div className=\"stat-label\">Cache Support</div>\n                  </div>\n                  <div className=\"stat\">\n                    <div className=\"stat-number\">100%</div>\n                    <div className=\"stat-label\">Open Source</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"footer\">\n        <div className=\"container\">\n          <div className=\"footer-content\">\n            <div className=\"footer-logo\">\n              <HiOutlineSpeakerphone className=\"logo-icon\" />\n              <span className=\"logo-text\">ISOBEL</span>\n            </div>\n            <div className=\"footer-links\">\n              <a\n                href=\"https://github.com/soulwax/ISOBEL\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                GitHub\n              </a>\n              <a\n                href=\"https://github.com/soulwax/ISOBEL/blob/master/LICENSE\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                License\n              </a>\n            </div>\n          </div>\n          <div className=\"footer-bottom\">\n            <p>\u00a9 {new Date().getFullYear()} ISOBEL. Licensed under GPLv3.</p>\n          </div>\n        </div>\n      </footer>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n",
    "web/src/lib/errors.ts": "// File: src/lib/errors.ts\n\n/**\n * Custom error classes for better error handling\n */\n\nexport class AuthenticationError extends Error {\n  constructor(message: string = \"Authentication required\") {\n    super(message);\n    this.name = \"AuthenticationError\";\n    Object.setPrototypeOf(this, AuthenticationError.prototype);\n  }\n}\n\nexport class AuthorizationError extends Error {\n  constructor(message: string = \"Insufficient permissions\") {\n    super(message);\n    this.name = \"AuthorizationError\";\n    Object.setPrototypeOf(this, AuthorizationError.prototype);\n  }\n}\n\nexport class ValidationError extends Error {\n  constructor(message: string = \"Validation failed\", public details?: unknown) {\n    super(message);\n    this.name = \"ValidationError\";\n    Object.setPrototypeOf(this, ValidationError.prototype);\n  }\n}\n\nexport class NotFoundError extends Error {\n  constructor(message: string = \"Resource not found\") {\n    super(message);\n    this.name = \"NotFoundError\";\n    Object.setPrototypeOf(this, NotFoundError.prototype);\n  }\n}\n\nexport class DatabaseError extends Error {\n  constructor(message: string = \"Database operation failed\", public originalError?: unknown) {\n    super(message);\n    this.name = \"DatabaseError\";\n    Object.setPrototypeOf(this, DatabaseError.prototype);\n  }\n}\n",
    "web/src/lib/validation.ts": "// File: src/lib/validation.ts\n\nimport { z } from 'zod';\n\n/**\n * Zod schema for guild settings validation\n */\nexport const guildSettingsSchema = z.object({\n  playlistLimit: z.number().int().min(1).max(200).optional(),\n  secondsToWaitAfterQueueEmpties: z.number().int().min(0).max(300).optional(),\n  leaveIfNoListeners: z.boolean().optional(),\n  queueAddResponseEphemeral: z.boolean().optional(),\n  autoAnnounceNextSong: z.boolean().optional(),\n  defaultVolume: z.number().int().min(0).max(100).optional(),\n  defaultQueuePageSize: z.number().int().min(1).max(30).optional(),\n  turnDownVolumeWhenPeopleSpeak: z.boolean().optional(),\n  turnDownVolumeWhenPeopleSpeakTarget: z.number().int().min(0).max(100).optional(),\n}).strict(); // Reject unknown fields\n\nexport type GuildSettingsInput = z.infer<typeof guildSettingsSchema>;\n",
    "web/src/lib/logger.ts": "// File: src/lib/logger.ts\n\nimport winston from 'winston';\n\n/**\n * Configured Winston logger instance\n */\nexport const logger = winston.createLogger({\n  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',\n  format: winston.format.combine(\n    winston.format.timestamp(),\n    winston.format.errors({ stack: true }),\n    winston.format.json()\n  ),\n  defaultMeta: { service: 'isobel-web' },\n  transports: [\n    // Write all logs with importance level of `error` or less to `error.log`\n    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),\n    // Write all logs with importance level of `info` or less to `combined.log`\n    new winston.transports.File({ filename: 'logs/combined.log' }),\n  ],\n});\n\n// If we're not in production, log to the console as well\nif (process.env.NODE_ENV !== 'production') {\n  logger.add(new winston.transports.Console({\n    format: winston.format.combine(\n      winston.format.colorize(),\n      winston.format.simple()\n    ),\n  }));\n}\n",
    "web/src/lib/env.ts": "// File: src/lib/env.ts\n\n/**\n * Environment variable validation and access\n */\n\n/**\n * Get required environment variable or throw error\n */\nexport function requireEnv(key: string): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing required environment variable: ${key}`);\n  }\n  return value;\n}\n\n/**\n * Get optional environment variable with default\n */\nexport function getEnv(key: string, defaultValue: string): string {\n  return process.env[key] || defaultValue;\n}\n\n/**\n * Validate all required environment variables at startup\n */\nexport function validateEnv(): void {\n  const required = [\n    'DISCORD_CLIENT_ID',\n    'DISCORD_CLIENT_SECRET',\n    'NEXTAUTH_SECRET',\n  ];\n\n  const missing: string[] = [];\n  for (const key of required) {\n    if (!process.env[key]) {\n      missing.push(key);\n    }\n  }\n\n  if (missing.length > 0) {\n    throw new Error(`Missing required environment variables: ${missing.join(', ')}`);\n  }\n}\n",
    "web/src/lib/auth-client.ts": "// File: src/lib/auth-client.ts\n\n/**\n * Client-side authentication utilities\n * For use in React components\n */\n\n// In development, use proxy. In production, use full URL or relative path\nconst AUTH_API_URL = import.meta.env.PROD \n  ? (import.meta.env.VITE_AUTH_API_URL || '/api/auth')\n  : '/api/auth';\n\nexport async function signIn() {\n  // NextAuth v5 signin - redirects to Discord OAuth\n  window.location.href = `${AUTH_API_URL}/signin?callbackUrl=${encodeURIComponent(window.location.origin)}`;\n}\n\nexport async function signOut() {\n  const response = await fetch(`${AUTH_API_URL}/signout`, {\n    method: 'POST',\n    credentials: 'include',\n  });\n  \n  if (response.ok) {\n    window.location.href = '/';\n  }\n}\n\nexport async function getSession() {\n  try {\n    const response = await fetch(`${AUTH_API_URL}/session`, {\n      credentials: 'include',\n    });\n    \n    if (!response.ok) {\n      return null;\n    }\n    \n    return await response.json();\n  } catch (error) {\n    console.error('Failed to get session:', error);\n    return null;\n  }\n}\n",
    "web/src/lib/utils.ts": "// File: src/lib/utils.ts\n\n/**\n * Utility functions for security, validation, and common operations\n */\n\n/**\n * Escape HTML to prevent XSS attacks\n */\nexport function escapeHtml(unsafe: string): string {\n  return unsafe\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n}\n\n/**\n * Validate Discord ID format (17-19 digit numbers)\n */\nexport function validateDiscordId(id: string): boolean {\n  return /^\\d{17,19}$/.test(id);\n}\n\n/**\n * Validate guild ID format\n */\nexport function validateGuildId(guildId: string): boolean {\n  return validateDiscordId(guildId);\n}\n\n/**\n * Check if user has MANAGE_GUILD permission\n * MANAGE_GUILD = 0x20 (32 in decimal)\n */\nexport function hasManageGuildPermission(permissions: string | null): boolean {\n  if (!permissions) return false;\n  try {\n    const perms = BigInt(permissions);\n    const MANAGE_GUILD = BigInt(0x20);\n    return (perms & MANAGE_GUILD) === MANAGE_GUILD;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check if user has ADMINISTRATOR permission\n * ADMINISTRATOR = 0x8 (8 in decimal)\n */\nexport function hasAdministratorPermission(permissions: string | null): boolean {\n  if (!permissions) return false;\n  try {\n    const perms = BigInt(permissions);\n    const ADMINISTRATOR = BigInt(0x8);\n    return (perms & ADMINISTRATOR) === ADMINISTRATOR;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check if user can manage guild settings\n * Requires either MANAGE_GUILD or ADMINISTRATOR permission\n */\nexport function canManageGuildSettings(permissions: string | null): boolean {\n  return hasManageGuildPermission(permissions) || hasAdministratorPermission(permissions);\n}\n",
    "web/src/auth/config.ts": "// File: src/auth/config.ts\n\nimport { DrizzleAdapter } from '@auth/drizzle-adapter';\nimport Discord from 'next-auth/providers/discord';\nimport type { DefaultSession, NextAuthConfig } from 'next-auth';\nimport { db } from '../db/index.js';\nimport { discordUsers, discordGuilds, guildMembers } from '../db/schema.js';\nimport { eq, sql } from 'drizzle-orm';\nimport { requireEnv } from '../lib/env.js';\nimport { logger } from '../lib/logger.js';\n\ndeclare module 'next-auth' {\n  interface Session extends DefaultSession {\n    user: {\n      id: string;\n      discordId?: string;\n    } & DefaultSession['user'];\n  }\n}\n\nexport const authConfig = {\n  adapter: DrizzleAdapter(db),\n  trustHost: true, // Required for NextAuth v5 when not using Next.js\n  basePath: '/api/auth', // Set the base path for auth routes\n  providers: [\n    Discord({\n      clientId: requireEnv('DISCORD_CLIENT_ID'),\n      clientSecret: requireEnv('DISCORD_CLIENT_SECRET'),\n      authorization: {\n        params: {\n          scope: 'identify email guilds',\n        },\n      },\n    }),\n  ],\n  callbacks: {\n    async signIn({ user, account, profile }) {\n      if (account?.provider === 'discord' && account.access_token && profile && user.id) {\n        try {\n          // Save or update Discord user data\n          const discordUserData = {\n            id: profile.id as string,\n            userId: user.id,\n            username: (profile.username || profile.name || 'Unknown') as string,\n            discriminator: (profile.discriminator as string) || null,\n            globalName: (profile.global_name as string) || null,\n            avatar: (profile.avatar as string) || null,\n            bot: false,\n            system: false,\n            mfaEnabled: false,\n            verified: false,\n            updatedAt: new Date(),\n          };\n\n          await db\n            .insert(discordUsers)\n            .values(discordUserData)\n            .onConflictDoUpdate({\n              target: discordUsers.id,\n              set: {\n                username: discordUserData.username,\n                globalName: discordUserData.globalName,\n                avatar: discordUserData.avatar,\n                updatedAt: discordUserData.updatedAt,\n              },\n            });\n\n          // Fetch and save user's guilds\n          const guildsResponse = await fetch('https://discord.com/api/v10/users/@me/guilds', {\n            headers: {\n              Authorization: `Bearer ${account.access_token}`,\n            },\n          });\n\n          if (guildsResponse.ok) {\n            const guilds = await guildsResponse.json();\n            const discordUserId = profile.id as string;\n\n            // Use transaction to ensure atomicity and better performance\n            await db.transaction(async (tx) => {\n              // Prepare all guild data\n              const guildsData = guilds.map((guild: any) => ({\n                id: guild.id,\n                name: guild.name,\n                icon: guild.icon || null,\n                ownerId: guild.owner_id || '',\n                owner: guild.owner || false,\n                permissions: guild.permissions?.toString() || null,\n                updatedAt: new Date(),\n              }));\n\n              // Prepare all member data\n              const membersData = guilds.map((guild: any) => ({\n                id: `${guild.id}_${discordUserId}`,\n                guildId: guild.id,\n                userId: discordUserId,\n                permissions: guild.permissions?.toString() || null,\n                updatedAt: new Date(),\n              }));\n\n              // Batch insert/update guilds\n              // PostgreSQL supports efficient upserts with ON CONFLICT\n              // All operations are done in a single transaction for atomicity\n              for (const guildData of guildsData) {\n                await tx\n                  .insert(discordGuilds)\n                  .values(guildData)\n                  .onConflictDoUpdate({\n                    target: discordGuilds.id,\n                    set: {\n                      name: sql`excluded.name`,\n                      icon: sql`excluded.icon`,\n                      permissions: sql`excluded.permissions`,\n                      updatedAt: sql`excluded.updatedAt`,\n                    },\n                  });\n              }\n\n              // Batch insert/update members\n              for (const memberData of membersData) {\n                await tx\n                  .insert(guildMembers)\n                  .values(memberData)\n                  .onConflictDoUpdate({\n                    target: guildMembers.id,\n                    set: {\n                      permissions: sql`excluded.permissions`,\n                      updatedAt: sql`excluded.updatedAt`,\n                    },\n                  });\n              }\n            });\n          }\n        } catch (error) {\n          logger.error('Error saving Discord data', { error, userId: user.id });\n          // Don't block sign-in if guild fetching fails\n        }\n      }\n      return true;\n    },\n    async session({ session, user }) {\n      if (session.user) {\n        session.user.id = user.id;\n        // Get Discord ID from discordUsers table\n        const discordUser = await db\n          .select()\n          .from(discordUsers)\n          .where(eq(discordUsers.userId, user.id))\n          .limit(1);\n        \n        if (discordUser.length > 0) {\n          session.user.discordId = discordUser[0].id;\n        }\n      }\n      return session;\n    },\n  },\n  // Use default NextAuth pages (auto-generated signin page)\n  session: {\n    strategy: 'database',\n  },\n  secret: requireEnv('NEXTAUTH_SECRET'),\n} satisfies NextAuthConfig;\n",
    "web/src/auth/index.ts": "// File: src/auth/index.ts\n\nimport NextAuth from 'next-auth';\nimport { authConfig } from './config.js';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth(authConfig);\n",
    "web/src/hooks/useAuth.ts": "// File: src/hooks/useAuth.ts\n\nimport { useState, useEffect } from 'react';\nimport { getSession, signIn, signOut } from '../lib/auth-client';\n\ninterface Session {\n  user?: {\n    id: string;\n    name?: string;\n    email?: string;\n    image?: string;\n  };\n  expires?: string;\n}\n\nexport function useAuth() {\n  const [session, setSession] = useState<Session | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const refreshSession = async () => {\n    const sessionData = await getSession();\n    setSession(sessionData);\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    refreshSession();\n\n    // Refresh session when window gains focus (e.g., after OAuth redirect)\n    const handleFocus = () => {\n      refreshSession();\n    };\n    window.addEventListener('focus', handleFocus);\n\n    return () => {\n      window.removeEventListener('focus', handleFocus);\n    };\n  }, []);\n\n  const handleSignIn = async () => {\n    await signIn();\n  };\n\n  const handleSignOut = async () => {\n    await signOut();\n    setSession(null);\n  };\n\n  return {\n    session,\n    loading,\n    signIn: handleSignIn,\n    signOut: handleSignOut,\n    isAuthenticated: !!session?.user,\n  };\n}\n",
    "web/src/components/HealthIndicator.tsx": "// File: src/components/HealthIndicator.tsx\n\nimport { useEffect, useState } from 'react';\nimport { HiCheckCircle, HiXCircle } from 'react-icons/hi';\nimport './HealthIndicator.css';\n\ninterface HealthStatus {\n  status: 'ok' | 'not_ready' | 'error';\n  ready: boolean;\n  guilds?: number;\n  uptime?: number;\n  uptimeFormatted?: string;\n  timestamp?: string;\n}\n\nexport default function HealthIndicator() {\n  const [health, setHealth] = useState<HealthStatus | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const checkHealth = async () => {\n    try {\n      // Call the bot health endpoint directly (CORS is now enabled on the bot side)\n      const botHealthUrl = import.meta.env.VITE_BOT_HEALTH_URL || 'https://isobelhealth.soulwax.dev';\n      const healthUrl = `${botHealthUrl}/health`;\n      \n      // Simple GET request - no headers or credentials needed, avoids OPTIONS preflight\n      const response = await fetch(healthUrl);\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(`Health check failed: ${response.status} ${response.statusText}`, errorText);\n        throw new Error(`Health check failed with status ${response.status}`);\n      }\n      \n      const data = await response.json();\n      setHealth(data);\n      setIsLoading(false);\n    } catch (error) {\n      console.error('Health check error:', error);\n      setHealth({\n        status: 'error',\n        ready: false,\n      });\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    checkHealth();\n    const interval = setInterval(checkHealth, 30000); // Check every 30 seconds\n    return () => clearInterval(interval);\n  }, []);\n\n  if (isLoading) {\n    return (\n      <div className=\"health-indicator loading\">\n        <div className=\"health-dot pulsing\"></div>\n        <span className=\"health-text\">Checking status...</span>\n      </div>\n    );\n  }\n\n  if (!health || health.status === 'error') {\n    return (\n      <div className=\"health-indicator offline\">\n        <HiXCircle className=\"health-icon\" />\n        <div className=\"health-info\">\n          <span className=\"health-text\">Offline</span>\n          <span className=\"health-subtext\">Bot is not responding</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (health.status === 'ok' && health.ready) {\n    return (\n      <div className=\"health-indicator online\">\n        <HiCheckCircle className=\"health-icon\" />\n        <div className=\"health-info\">\n          <span className=\"health-text\">Online</span>\n          <span className=\"health-subtext\">\n            {health.guilds !== undefined && `${health.guilds} server${health.guilds !== 1 ? 's' : ''}`}\n            {health.uptimeFormatted && ` \u2022 Uptime: ${health.uptimeFormatted}`}\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"health-indicator starting\">\n      <div className=\"health-dot pulsing\"></div>\n      <div className=\"health-info\">\n        <span className=\"health-text\">Starting</span>\n        <span className=\"health-subtext\">Bot is initializing</span>\n      </div>\n    </div>\n  );\n}\n",
    "web/src/components/DiscordGuildsSidebar.tsx": "// File: src/components/DiscordGuildsSidebar.tsx\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '../hooks/useAuth';\nimport './DiscordGuildsSidebar.css';\n\ninterface Guild {\n  id: string;\n  name: string;\n  icon: string | null;\n  permissions: string | null;\n}\n\ninterface DiscordGuildsSidebarProps {\n  onGuildSelect?: (guild: Guild) => void;\n  selectedGuildId?: string | null;\n}\n\nexport default function DiscordGuildsSidebar({ onGuildSelect, selectedGuildId }: DiscordGuildsSidebarProps) {\n  const { isAuthenticated, session } = useAuth();\n  const [guilds, setGuilds] = useState<Guild[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      setLoading(false);\n      return;\n    }\n\n    const fetchGuilds = async () => {\n      try {\n        setLoading(true);\n        const authApiUrl = import.meta.env.PROD \n          ? (import.meta.env.VITE_AUTH_API_URL || '/api')\n          : '/api';\n        \n        const response = await fetch(`${authApiUrl}/guilds`, {\n          credentials: 'include',\n        });\n\n        if (!response.ok) {\n          if (response.status === 401) {\n            setError(null);\n            setGuilds([]);\n            return;\n          }\n          throw new Error('Failed to fetch guilds');\n        }\n\n        const data = await response.json();\n        setGuilds(data.guilds || []);\n        setError(null);\n      } catch (err) {\n        console.error('Error fetching guilds:', err);\n        setError('Failed to load servers');\n        setGuilds([]);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchGuilds();\n  }, [isAuthenticated, session]);\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  const getGuildIconUrl = (guildId: string, icon: string | null) => {\n    if (!icon) {\n      return null;\n    }\n    // Discord CDN URL for guild icons\n    return `https://cdn.discordapp.com/icons/${guildId}/${icon}.png`;\n  };\n\n  const getGuildInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map((word) => word[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <div className=\"discord-guilds-sidebar\">\n      <div className=\"sidebar-header\">\n        <h3 className=\"sidebar-title\">Your Servers</h3>\n      </div>\n      <div className=\"sidebar-content\">\n        {loading ? (\n          <div className=\"sidebar-loading\">\n            <span>Loading servers...</span>\n          </div>\n        ) : error ? (\n          <div className=\"sidebar-error\">\n            <span>{error}</span>\n          </div>\n        ) : guilds.length === 0 ? (\n          <div className=\"sidebar-empty\">\n            <span>No servers found</span>\n          </div>\n        ) : (\n          <div className=\"guilds-list\">\n            {guilds.map((guild) => (\n              <div\n                key={guild.id}\n                className={`guild-item ${selectedGuildId === guild.id ? 'selected' : ''}`}\n                title={guild.name}\n                onClick={() => onGuildSelect?.(guild)}\n                role=\"button\"\n                tabIndex={0}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    onGuildSelect?.(guild);\n                  }\n                }}\n              >\n                {getGuildIconUrl(guild.id, guild.icon) ? (\n                  <img\n                    src={getGuildIconUrl(guild.id, guild.icon)!}\n                    alt={guild.name}\n                    className=\"guild-icon\"\n                  />\n                ) : (\n                  <div className=\"guild-icon-placeholder\">\n                    {getGuildInitials(guild.name)}\n                  </div>\n                )}\n                <span className=\"guild-name\">{guild.name}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n",
    "web/src/components/HealthIndicator.css": "/* File: src/components/HealthIndicator.css */\n\n.health-indicator {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 9999px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.3s ease;\n  cursor: default;\n}\n\n.health-indicator.online {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n  border: 1px solid rgba(34, 197, 94, 0.2);\n}\n\n.health-indicator.offline {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n  border: 1px solid rgba(239, 68, 68, 0.2);\n}\n\n.health-indicator.starting {\n  background: rgba(251, 191, 36, 0.1);\n  color: #fbbf24;\n  border: 1px solid rgba(251, 191, 36, 0.2);\n}\n\n.health-indicator.loading {\n  background: rgba(148, 163, 184, 0.1);\n  color: #94a3b8;\n  border: 1px solid rgba(148, 163, 184, 0.2);\n}\n\n.health-icon {\n  width: 1.25rem;\n  height: 1.25rem;\n  flex-shrink: 0;\n}\n\n.health-dot {\n  width: 0.75rem;\n  height: 0.75rem;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.health-indicator.starting .health-dot {\n  background-color: #fbbf24;\n}\n\n.health-indicator.loading .health-dot {\n  background-color: #94a3b8;\n}\n\n.health-dot.pulsing {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.health-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.125rem;\n}\n\n.health-text {\n  line-height: 1.25;\n}\n\n.health-subtext {\n  font-size: 0.75rem;\n  opacity: 0.8;\n  line-height: 1;\n}\n\n@media (max-width: 768px) {\n  .health-indicator {\n    padding: 0.375rem 0.75rem;\n    font-size: 0.75rem;\n  }\n\n  .health-icon {\n    width: 1rem;\n    height: 1rem;\n  }\n\n  .health-dot {\n    width: 0.625rem;\n    height: 0.625rem;\n  }\n\n  .health-subtext {\n    display: none;\n  }\n}\n",
    "web/src/components/DiscordLogin.css": "/* File: src/components/DiscordLogin.css */\n\n.discord-login {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.discord-login.loading {\n  color: var(--text-secondary);\n  font-size: 0.9rem;\n}\n\n.discord-login.authenticated {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.user-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  border: 2px solid var(--discord-blurple);\n  object-fit: cover;\n}\n\n.user-name {\n  color: var(--text-primary);\n  font-weight: 500;\n  font-size: 0.9rem;\n}\n\n.login-button {\n  padding: 0.5rem 1rem;\n  border: none;\n  border-radius: 4px;\n  font-weight: 500;\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  text-decoration: none;\n  display: inline-block;\n  font-family: inherit;\n}\n\n.login-button-primary {\n  background-color: var(--discord-blurple);\n  color: var(--text-primary);\n}\n\n.login-button-primary:hover {\n  background-color: var(--discord-blurple-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.3);\n}\n\n.login-button-primary:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n.logout-button {\n  background-color: transparent;\n  color: var(--text-secondary);\n  border: 1px solid var(--border-color);\n}\n\n.logout-button:hover {\n  background-color: var(--card-bg);\n  color: var(--text-primary);\n  border-color: var(--text-muted);\n  transform: translateY(-1px);\n}\n\n.logout-button:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n@media (max-width: 768px) {\n  .user-name {\n    display: none;\n  }\n  \n  .discord-login.authenticated {\n    gap: 0.5rem;\n  }\n}\n\n",
    "web/src/components/DiscordGuildsSidebar.css": "/* File: src/components/DiscordGuildsSidebar.css */\n\n.discord-guilds-sidebar {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 240px;\n  height: 100vh;\n  background-color: var(--discord-darker);\n  border-right: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  z-index: 50;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.discord-guilds-sidebar::-webkit-scrollbar {\n  width: 8px;\n}\n\n.discord-guilds-sidebar::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.discord-guilds-sidebar::-webkit-scrollbar-thumb {\n  background: var(--discord-dark);\n  border-radius: 4px;\n}\n\n.discord-guilds-sidebar::-webkit-scrollbar-thumb:hover {\n  background: var(--border-color);\n}\n\n.sidebar-header {\n  padding: 1rem;\n  border-bottom: 1px solid var(--border-color);\n  background-color: var(--discord-darkest);\n  position: sticky;\n  top: 0;\n  z-index: 10;\n}\n\n.sidebar-title {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-secondary);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin: 0;\n}\n\n.sidebar-content {\n  flex: 1;\n  padding: 0.5rem;\n  overflow-y: auto;\n}\n\n.sidebar-loading,\n.sidebar-error,\n.sidebar-empty {\n  padding: 1rem;\n  text-align: center;\n  color: var(--text-muted);\n  font-size: 0.875rem;\n}\n\n.sidebar-error {\n  color: #f04747;\n}\n\n.guilds-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.guild-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: var(--text-secondary);\n  position: relative;\n}\n\n.guild-item::before {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 3px;\n  height: 0;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  border-radius: 0 2px 2px 0;\n  transition: height 0.2s ease;\n}\n\n.guild-item:hover {\n  background-color: var(--card-bg);\n  color: var(--text-primary);\n  padding-left: 0.75rem;\n}\n\n.guild-item:hover::before {\n  height: 60%;\n}\n\n.guild-item.selected {\n  background-color: var(--discord-blurple);\n  color: var(--text-primary);\n  padding-left: 0.75rem;\n}\n\n.guild-item.selected::before {\n  height: 80%;\n}\n\n.guild-item.selected:hover {\n  background-color: var(--discord-blurple-hover);\n}\n\n.guild-item:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n.guild-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  object-fit: cover;\n  flex-shrink: 0;\n  transition: transform 0.2s ease;\n  border: 2px solid transparent;\n}\n\n.guild-item:hover .guild-icon {\n  transform: scale(1.1);\n  border-color: var(--discord-blurple);\n}\n\n.guild-icon-placeholder {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, var(--discord-blurple), var(--gradient-end));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: var(--text-primary);\n  flex-shrink: 0;\n  transition: transform 0.2s ease;\n  border: 2px solid transparent;\n}\n\n.guild-item:hover .guild-icon-placeholder {\n  transform: scale(1.1) rotate(5deg);\n  border-color: var(--discord-blurple);\n}\n\n.guild-name {\n  font-size: 0.9375rem;\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex: 1;\n}\n\n/* Responsive: Hide sidebar on mobile */\n@media (max-width: 768px) {\n  .discord-guilds-sidebar {\n    display: none;\n  }\n}\n\n",
    "web/src/components/GuildSettings.css": "/* File: src/components/GuildSettings.css */\n\n.guild-settings {\n  margin-left: 240px; /* Account for sidebar */\n  min-height: 100vh;\n  background-color: var(--discord-dark);\n  color: var(--text-primary);\n  padding: 2rem;\n}\n\n.settings-loading,\n.settings-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 50vh;\n  gap: 1rem;\n  color: var(--text-secondary);\n}\n\n.settings-error {\n  color: #f04747;\n}\n\n.settings-header {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 2rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.back-button {\n  padding: 0.5rem 1rem;\n  background-color: transparent;\n  border: 1px solid var(--border-color);\n  border-radius: 4px;\n  color: var(--text-primary);\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s;\n  font-family: inherit;\n}\n\n.back-button:hover {\n  background-color: var(--card-bg);\n  border-color: var(--text-muted);\n  transform: translateY(-1px);\n}\n\n.back-button:focus {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n.guild-header-info {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.guild-header-icon {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  object-fit: cover;\n}\n\n.guild-header-icon-placeholder {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: var(--text-primary);\n  flex-shrink: 0;\n}\n\n.guild-header-name {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--text-primary);\n}\n\n.settings-content {\n  max-width: 800px;\n}\n\n.settings-message {\n  padding: 1rem;\n  border-radius: 4px;\n  margin-bottom: 1.5rem;\n  font-size: 0.9rem;\n}\n\n.settings-message.error {\n  background-color: rgba(240, 71, 71, 0.1);\n  border: 1px solid #f04747;\n  color: #f04747;\n}\n\n.settings-message.success {\n  background-color: rgba(67, 181, 129, 0.1);\n  border: 1px solid #43b581;\n  color: #43b581;\n}\n\n.settings-form {\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n}\n\n.settings-section {\n  background-color: var(--card-bg);\n  border-radius: 8px;\n  padding: 1.5rem;\n  border: 1px solid var(--border-color);\n  transition: all 0.3s;\n}\n\n.settings-section:hover {\n  border-color: var(--discord-blurple);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.1);\n}\n\n.section-title {\n  margin: 0 0 1.5rem 0;\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-primary);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n\n.setting-field {\n  margin-bottom: 1.5rem;\n}\n\n.setting-field:last-child {\n  margin-bottom: 0;\n}\n\n.setting-field label {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  font-weight: 500;\n  color: var(--text-primary);\n  cursor: pointer;\n}\n\n.setting-field label input[type=\"checkbox\"] {\n  margin-right: 0.5rem;\n  cursor: pointer;\n}\n\n.setting-field label:has(input[type=\"checkbox\"]) {\n  flex-direction: row;\n  align-items: flex-start;\n}\n\n.setting-field label:has(input[type=\"checkbox\"]) .field-description {\n  margin-left: 1.5rem;\n}\n\n.field-description {\n  font-size: 0.85rem;\n  color: var(--text-secondary);\n  font-weight: 400;\n  margin-top: 0.25rem;\n  line-height: 1.5;\n}\n\n.setting-field input[type=\"number\"],\n.setting-field input[type=\"text\"] {\n  padding: 0.625rem;\n  background-color: var(--discord-dark);\n  border: 1px solid var(--border-color);\n  border-radius: 4px;\n  color: var(--text-primary);\n  font-size: 0.9rem;\n  font-family: inherit;\n  width: 100%;\n  max-width: 200px;\n  transition: all 0.2s;\n}\n\n.setting-field input[type=\"number\"]:hover,\n.setting-field input[type=\"text\"]:hover {\n  border-color: var(--text-muted);\n}\n\n.setting-field input[type=\"number\"]:focus,\n.setting-field input[type=\"text\"]:focus {\n  outline: none;\n  border-color: var(--discord-blurple);\n  box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.1);\n}\n\n.setting-field input[type=\"checkbox\"] {\n  width: 18px;\n  height: 18px;\n  accent-color: var(--discord-blurple);\n  cursor: pointer;\n  flex-shrink: 0;\n}\n\n.settings-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--border-color);\n  margin-top: 1rem;\n}\n\n.save-button {\n  padding: 0.75rem 2rem;\n  background-color: var(--discord-blurple);\n  border: none;\n  border-radius: 4px;\n  color: var(--text-primary);\n  font-weight: 600;\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-family: inherit;\n}\n\n.save-button:hover:not(:disabled) {\n  background-color: var(--discord-blurple-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4);\n}\n\n.save-button:focus:not(:disabled) {\n  outline: 2px solid var(--discord-blurple);\n  outline-offset: 2px;\n}\n\n.save-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n@media (max-width: 768px) {\n  .guild-settings {\n    margin-left: 0;\n    padding: 1rem;\n  }\n\n  .settings-header {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .guild-header-info {\n    width: 100%;\n  }\n}\n\n\n",
    "web/src/components/DiscordLogin.tsx": "// File: src/components/DiscordLogin.tsx\n\nimport { useAuth } from '../hooks/useAuth';\nimport './DiscordLogin.css';\n\nexport default function DiscordLogin() {\n  const { session, loading, signIn, signOut, isAuthenticated } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"discord-login loading\">\n        <span className=\"login-text\">Loading...</span>\n      </div>\n    );\n  }\n\n  if (isAuthenticated && session?.user) {\n    return (\n      <div className=\"discord-login authenticated\">\n        <div className=\"user-info\">\n          {session.user.image && (\n            <img\n              src={session.user.image}\n              alt={session.user.name || 'User'}\n              className=\"user-avatar\"\n            />\n          )}\n          <span className=\"user-name\">{session.user.name || 'User'}</span>\n        </div>\n        <button onClick={signOut} className=\"login-button logout-button\">\n          Logout\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <button onClick={signIn} className=\"login-button login-button-primary\">\n      Login with Discord\n    </button>\n  );\n}\n\n",
    "web/src/components/GuildSettings.tsx": "// File: src/components/GuildSettings.tsx\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '../hooks/useAuth';\nimport './GuildSettings.css';\n\ninterface GuildSettings {\n  guildId: string;\n  playlistLimit: number;\n  secondsToWaitAfterQueueEmpties: number;\n  leaveIfNoListeners: boolean;\n  queueAddResponseEphemeral: boolean;\n  autoAnnounceNextSong: boolean;\n  defaultVolume: number;\n  defaultQueuePageSize: number;\n  turnDownVolumeWhenPeopleSpeak: boolean;\n  turnDownVolumeWhenPeopleSpeakTarget: number;\n}\n\ninterface Guild {\n  id: string;\n  name: string;\n  icon: string | null;\n}\n\ninterface GuildSettingsProps {\n  guild: Guild | null;\n  onBack: () => void;\n}\n\nexport default function GuildSettings({ guild, onBack }: GuildSettingsProps) {\n  const { isAuthenticated } = useAuth();\n  const [settings, setSettings] = useState<GuildSettings | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  useEffect(() => {\n    if (!guild || !isAuthenticated) {\n      setLoading(false);\n      return;\n    }\n\n    const fetchSettings = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const authApiUrl = import.meta.env.PROD \n          ? (import.meta.env.VITE_AUTH_API_URL || '/api')\n          : '/api';\n        \n        const response = await fetch(`${authApiUrl}/guilds/${guild.id}/settings`, {\n          credentials: 'include',\n        });\n\n        if (!response.ok) {\n          if (response.status === 401) {\n            setError('Please log in to view settings');\n            return;\n          }\n          if (response.status === 403) {\n            setError('You do not have access to this server');\n            return;\n          }\n          throw new Error('Failed to fetch settings');\n        }\n\n        const data = await response.json();\n        setSettings(data.settings);\n      } catch (err) {\n        console.error('Error fetching settings:', err);\n        setError('Failed to load settings');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchSettings();\n  }, [guild, isAuthenticated]);\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if (!guild || !settings) return;\n\n    try {\n      setSaving(true);\n      setError(null);\n      setSuccess(false);\n      \n      const authApiUrl = import.meta.env.PROD \n        ? (import.meta.env.VITE_AUTH_API_URL || '/api')\n        : '/api';\n      \n      const response = await fetch(`${authApiUrl}/guilds/${guild.id}/settings`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify(settings),\n      });\n\n      if (!response.ok) {\n        if (response.status === 401) {\n          setError('Please log in to update settings');\n          return;\n        }\n        if (response.status === 403) {\n          setError('You do not have permission to update settings');\n          return;\n        }\n        throw new Error('Failed to update settings');\n      }\n\n      const data = await response.json();\n      setSettings(data.settings);\n      setSuccess(true);\n      setTimeout(() => setSuccess(false), 3000);\n    } catch (err) {\n      console.error('Error updating settings:', err);\n      setError('Failed to save settings');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleChange = (field: keyof GuildSettings, value: string | number | boolean) => {\n    if (!settings) return;\n    setSettings({\n      ...settings,\n      [field]: value,\n    });\n  };\n\n  const getGuildIconUrl = (guildId: string, icon: string | null) => {\n    if (!icon) return null;\n    return `https://cdn.discordapp.com/icons/${guildId}/${icon}.png`;\n  };\n\n  if (!guild) {\n    return null;\n  }\n\n  if (loading) {\n    return (\n      <div className=\"guild-settings\">\n        <div className=\"settings-loading\">\n          <span>Loading settings...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && !settings) {\n    return (\n      <div className=\"guild-settings\">\n        <div className=\"settings-error\">\n          <span>{error}</span>\n          <button onClick={onBack} className=\"back-button\">Back to Servers</button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!settings) {\n    return null;\n  }\n\n  return (\n    <div className=\"guild-settings\">\n      <div className=\"settings-header\">\n        <button onClick={onBack} className=\"back-button\">\u2190 Back</button>\n        <div className=\"guild-header-info\">\n          {getGuildIconUrl(guild.id, guild.icon) ? (\n            <img\n              src={getGuildIconUrl(guild.id, guild.icon)!}\n              alt={guild.name}\n              className=\"guild-header-icon\"\n            />\n          ) : (\n            <div className=\"guild-header-icon-placeholder\">\n              {guild.name.substring(0, 2).toUpperCase()}\n            </div>\n          )}\n          <h2 className=\"guild-header-name\">{guild.name} Settings</h2>\n        </div>\n      </div>\n\n      <div className=\"settings-content\">\n        {error && (\n          <div className=\"settings-message error\">\n            {error}\n          </div>\n        )}\n        {success && (\n          <div className=\"settings-message success\">\n            Settings saved successfully!\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"settings-form\">\n          <div className=\"settings-section\">\n            <h3 className=\"section-title\">Playlist Settings</h3>\n            \n            <div className=\"setting-field\">\n              <label htmlFor=\"playlistLimit\">\n                Playlist Limit\n                <span className=\"field-description\">\n                  Maximum number of tracks that can be added from a playlist\n                </span>\n              </label>\n              <input\n                type=\"number\"\n                id=\"playlistLimit\"\n                min=\"1\"\n                max=\"200\"\n                value={settings.playlistLimit}\n                onChange={(e) => handleChange('playlistLimit', parseInt(e.target.value) || 50)}\n              />\n            </div>\n          </div>\n\n          <div className=\"settings-section\">\n            <h3 className=\"section-title\">Queue Settings</h3>\n            \n            <div className=\"setting-field\">\n              <label htmlFor=\"defaultQueuePageSize\">\n                Default Queue Page Size\n                <span className=\"field-description\">\n                  Number of tracks shown per page in the queue command\n                </span>\n              </label>\n              <input\n                type=\"number\"\n                id=\"defaultQueuePageSize\"\n                min=\"1\"\n                max=\"30\"\n                value={settings.defaultQueuePageSize}\n                onChange={(e) => handleChange('defaultQueuePageSize', parseInt(e.target.value) || 10)}\n              />\n            </div>\n\n            <div className=\"setting-field\">\n              <label htmlFor=\"queueAddResponseEphemeral\">\n                <input\n                  type=\"checkbox\"\n                  id=\"queueAddResponseEphemeral\"\n                  checked={settings.queueAddResponseEphemeral}\n                  onChange={(e) => handleChange('queueAddResponseEphemeral', e.target.checked)}\n                />\n                Hide Queue Add Responses\n                <span className=\"field-description\">\n                  Make queue add responses only visible to the user who added the track\n                </span>\n              </label>\n            </div>\n          </div>\n\n          <div className=\"settings-section\">\n            <h3 className=\"section-title\">Voice Channel Settings</h3>\n            \n            <div className=\"setting-field\">\n              <label htmlFor=\"secondsToWaitAfterQueueEmpties\">\n                Wait Time After Queue Empties (seconds)\n                <span className=\"field-description\">\n                  Time to wait before leaving the voice channel when queue empties (0 = never leave)\n                </span>\n              </label>\n              <input\n                type=\"number\"\n                id=\"secondsToWaitAfterQueueEmpties\"\n                min=\"0\"\n                max=\"300\"\n                value={settings.secondsToWaitAfterQueueEmpties}\n                onChange={(e) => handleChange('secondsToWaitAfterQueueEmpties', parseInt(e.target.value) || 30)}\n              />\n            </div>\n\n            <div className=\"setting-field\">\n              <label htmlFor=\"leaveIfNoListeners\">\n                <input\n                  type=\"checkbox\"\n                  id=\"leaveIfNoListeners\"\n                  checked={settings.leaveIfNoListeners}\n                  onChange={(e) => handleChange('leaveIfNoListeners', e.target.checked)}\n                />\n                Leave If No Listeners\n                <span className=\"field-description\">\n                  Automatically leave when all other participants leave the voice channel\n                </span>\n              </label>\n            </div>\n          </div>\n\n          <div className=\"settings-section\">\n            <h3 className=\"section-title\">Volume Settings</h3>\n            \n            <div className=\"setting-field\">\n              <label htmlFor=\"defaultVolume\">\n                Default Volume\n                <span className=\"field-description\">\n                  Default volume level (0-100)\n                </span>\n              </label>\n              <input\n                type=\"number\"\n                id=\"defaultVolume\"\n                min=\"0\"\n                max=\"100\"\n                value={settings.defaultVolume}\n                onChange={(e) => handleChange('defaultVolume', parseInt(e.target.value) || 100)}\n              />\n            </div>\n\n            <div className=\"setting-field\">\n              <label htmlFor=\"turnDownVolumeWhenPeopleSpeak\">\n                <input\n                  type=\"checkbox\"\n                  id=\"turnDownVolumeWhenPeopleSpeak\"\n                  checked={settings.turnDownVolumeWhenPeopleSpeak}\n                  onChange={(e) => handleChange('turnDownVolumeWhenPeopleSpeak', e.target.checked)}\n                />\n                Auto-Duck When People Speak\n                <span className=\"field-description\">\n                  Automatically lower volume when people are speaking\n                </span>\n              </label>\n            </div>\n\n            {settings.turnDownVolumeWhenPeopleSpeak && (\n              <div className=\"setting-field\">\n                <label htmlFor=\"turnDownVolumeWhenPeopleSpeakTarget\">\n                  Duck Volume Target\n                  <span className=\"field-description\">\n                    Volume level to lower to when people speak (0-100)\n                  </span>\n                </label>\n                <input\n                  type=\"number\"\n                  id=\"turnDownVolumeWhenPeopleSpeakTarget\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={settings.turnDownVolumeWhenPeopleSpeakTarget}\n                  onChange={(e) => handleChange('turnDownVolumeWhenPeopleSpeakTarget', parseInt(e.target.value) || 20)}\n                />\n              </div>\n            )}\n          </div>\n\n          <div className=\"settings-section\">\n            <h3 className=\"section-title\">Announcement Settings</h3>\n            \n            <div className=\"setting-field\">\n              <label htmlFor=\"autoAnnounceNextSong\">\n                <input\n                  type=\"checkbox\"\n                  id=\"autoAnnounceNextSong\"\n                  checked={settings.autoAnnounceNextSong}\n                  onChange={(e) => handleChange('autoAnnounceNextSong', e.target.checked)}\n                />\n                Auto-Announce Next Song\n                <span className=\"field-description\">\n                  Automatically announce when the next song starts playing\n                </span>\n              </label>\n            </div>\n          </div>\n\n          <div className=\"settings-actions\">\n            <button type=\"submit\" className=\"save-button\" disabled={saving}>\n              {saving ? 'Saving...' : 'Save Settings'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\n\n",
    "web/api/index.ts": "// File: api/index.ts\n// Vercel serverless function - main API handler\n\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\nimport { createApp } from '../src/server/app.js';\n\n// Create Express app (reuse server setup)\nconst app = createApp();\n\n// Export Vercel serverless function handler\nexport default function handler(req: VercelRequest, res: VercelResponse) {\n  // Convert Vercel request/response to Express format\n  return new Promise<void>((resolve) => {\n    app(req as any, res as any, () => {\n      resolve();\n    });\n  });\n}\n",
    "web/scripts/start-web.js": "// File: scripts/start-web.js\n// Wrapper script to start web server in dev or production mode\n\nimport { spawn } from 'child_process';\nimport { fileURLToPath } from 'url';\nimport { dirname, join } from 'path';\nimport { config } from 'dotenv';\n\n// Get __dirname equivalent in ES modules\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Load environment variables from .env file\nconfig();\n\nconst isProduction = process.env.NODE_ENV === 'production';\n\nif (isProduction) {\n  // In production, serve the optimized build from ./build\n  console.log('Starting production server (serving from ./build)...');\n  console.log(`PORT from environment: ${process.env.PORT || 'not set'}`);\n  // Use execFile to avoid shell injection and deprecation warning\n  const vitePreview = spawn('npm', ['run', 'preview'], {\n    cwd: join(__dirname, '..'),\n    stdio: 'inherit',\n    env: {\n      ...process.env, // Pass through all environment variables including PORT\n    },\n  });\n\n  vitePreview.on('error', (error) => {\n    console.error('Failed to start production server:', error);\n    process.exit(1);\n  });\n\n  vitePreview.on('exit', (code) => {\n    process.exit(code || 0);\n  });\n} else {\n  // In development, use vite dev server\n  console.log('Starting development server...');\n  console.log(`PORT from environment: ${process.env.PORT || 'not set'}`);\n  const viteDev = spawn('npm', ['run', 'dev'], {\n    cwd: join(__dirname, '..'),\n    stdio: 'inherit',\n    shell: true,\n    env: {\n      ...process.env, // Pass through all environment variables including PORT\n    },\n  });\n\n  viteDev.on('error', (error) => {\n    console.error('Failed to start development server:', error);\n    process.exit(1);\n  });\n\n  viteDev.on('exit', (code) => {\n    process.exit(code || 0);\n  });\n}\n",
    "web/scripts/migrate.ts": "// File: scripts/migrate.ts\n\nimport { config } from 'dotenv';\nimport { drizzle } from 'drizzle-orm/postgres-js';\nimport { migrate } from 'drizzle-orm/postgres-js/migrator';\nimport postgres from 'postgres';\nimport * as schema from '../src/db/schema';\n\n// Load environment variables from .env file\nconfig();\n\nconst databaseUrl = process.env.DATABASE_URL || process.env.POSTGRES_URL || '';\n\nif (!databaseUrl) {\n  console.error('DATABASE_URL or POSTGRES_URL environment variable is required');\n  process.exit(1);\n}\n\nconst client = postgres(databaseUrl, {\n  max: 1, // Use single connection for migrations\n});\n\nconst db = drizzle(client, { schema });\n\nasync function runMigrations() {\n  try {\n    console.log('Running migrations...');\n    await migrate(db, { migrationsFolder: './drizzle' });\n    console.log('Migrations completed!');\n  } catch (error) {\n    console.error('Migration failed:', error);\n    throw error;\n  } finally {\n    await client.end();\n  }\n}\n\nrunMigrations().catch((error) => {\n  console.error('Migration failed:', error);\n  process.exit(1);\n});\n",
    "web/drizzle.config.ts": "// File: drizzle.config.ts\n\nimport { defineConfig } from 'drizzle-kit';\n\nconst databaseUrl = process.env.DATABASE_URL || process.env.POSTGRES_URL;\n\nif (!databaseUrl) {\n  throw new Error(\n    'DATABASE_URL or POSTGRES_URL environment variable is required for drizzle-kit.\\n' +\n    'Please set one of these variables in your .env file or environment.'\n  );\n}\n\nexport default defineConfig({\n  schema: './src/db/schema.ts',\n  out: './drizzle',\n  dialect: 'postgresql',\n  dbCredentials: {\n    url: databaseUrl,\n  },\n});\n",
    "web/eslint.config.js": "// File: eslint.config.js\n\nimport js from '@eslint/js'\nimport globals from 'globals'\nimport reactHooks from 'eslint-plugin-react-hooks'\nimport reactRefresh from 'eslint-plugin-react-refresh'\nimport tseslint from 'typescript-eslint'\nimport { defineConfig, globalIgnores } from 'eslint/config'\n\nexport default defineConfig([\n  globalIgnores(['dist']),\n  {\n    files: ['**/*.{ts,tsx}'],\n    extends: [\n      js.configs.recommended,\n      tseslint.configs.recommended,\n      reactHooks.configs.flat.recommended,\n      reactRefresh.configs.vite,\n    ],\n    languageOptions: {\n      ecmaVersion: 2020,\n      globals: globals.browser,\n    },\n  },\n])\n",
    "web/drizzle/0000_bored_swarm.sql": "CREATE TABLE \"account\" (\n\t\"userId\" text NOT NULL,\n\t\"type\" text NOT NULL,\n\t\"provider\" text NOT NULL,\n\t\"providerAccountId\" text NOT NULL,\n\t\"refresh_token\" text,\n\t\"access_token\" text,\n\t\"expires_at\" integer,\n\t\"token_type\" text,\n\t\"scope\" text,\n\t\"id_token\" text,\n\t\"session_state\" text,\n\tCONSTRAINT \"account_provider_providerAccountId_pk\" PRIMARY KEY(\"provider\",\"providerAccountId\")\n);\n--> statement-breakpoint\nCREATE TABLE \"discord_guild\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"icon\" text,\n\t\"iconHash\" text,\n\t\"splash\" text,\n\t\"discoverySplash\" text,\n\t\"ownerId\" text NOT NULL,\n\t\"owner\" boolean DEFAULT false NOT NULL,\n\t\"permissions\" text,\n\t\"region\" text,\n\t\"afkChannelId\" text,\n\t\"afkTimeout\" integer,\n\t\"widgetEnabled\" boolean,\n\t\"widgetChannelId\" text,\n\t\"verificationLevel\" integer,\n\t\"defaultMessageNotifications\" integer,\n\t\"explicitContentFilter\" integer,\n\t\"roles\" text,\n\t\"emojis\" text,\n\t\"features\" text,\n\t\"mfaLevel\" integer,\n\t\"applicationId\" text,\n\t\"systemChannelId\" text,\n\t\"systemChannelFlags\" integer,\n\t\"rulesChannelId\" text,\n\t\"maxMembers\" integer,\n\t\"maxPresences\" integer,\n\t\"vanityUrlCode\" text,\n\t\"description\" text,\n\t\"banner\" text,\n\t\"premiumTier\" integer,\n\t\"premiumSubscriptionCount\" integer,\n\t\"preferredLocale\" text,\n\t\"publicUpdatesChannelId\" text,\n\t\"maxVideoChannelUsers\" integer,\n\t\"maxStageVideoChannelUsers\" integer,\n\t\"approximateMemberCount\" integer,\n\t\"approximatePresenceCount\" integer,\n\t\"nsfwLevel\" integer,\n\t\"joinedAt\" timestamp,\n\t\"createdAt\" timestamp DEFAULT now() NOT NULL,\n\t\"updatedAt\" timestamp DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE \"discord_user\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"userId\" text NOT NULL,\n\t\"username\" text NOT NULL,\n\t\"discriminator\" text,\n\t\"globalName\" text,\n\t\"avatar\" text,\n\t\"bot\" boolean DEFAULT false NOT NULL,\n\t\"system\" boolean DEFAULT false NOT NULL,\n\t\"mfaEnabled\" boolean DEFAULT false NOT NULL,\n\t\"banner\" text,\n\t\"accentColor\" integer,\n\t\"locale\" text,\n\t\"verified\" boolean DEFAULT false NOT NULL,\n\t\"email\" text,\n\t\"flags\" integer,\n\t\"premiumType\" integer,\n\t\"publicFlags\" integer,\n\t\"createdAt\" timestamp DEFAULT now() NOT NULL,\n\t\"updatedAt\" timestamp DEFAULT now() NOT NULL,\n\tCONSTRAINT \"discord_user_userId_unique\" UNIQUE(\"userId\")\n);\n--> statement-breakpoint\nCREATE TABLE \"guild_member\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"guildId\" text NOT NULL,\n\t\"userId\" text NOT NULL,\n\t\"nick\" text,\n\t\"avatar\" text,\n\t\"roles\" text DEFAULT '[]' NOT NULL,\n\t\"joinedAt\" timestamp,\n\t\"premiumSince\" timestamp,\n\t\"deaf\" boolean DEFAULT false NOT NULL,\n\t\"mute\" boolean DEFAULT false NOT NULL,\n\t\"pending\" boolean,\n\t\"permissions\" text,\n\t\"communicationDisabledUntil\" timestamp,\n\t\"createdAt\" timestamp DEFAULT now() NOT NULL,\n\t\"updatedAt\" timestamp DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE \"session\" (\n\t\"sessionToken\" text PRIMARY KEY NOT NULL,\n\t\"userId\" text NOT NULL,\n\t\"expires\" timestamp NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE \"setting\" (\n\t\"guildId\" text PRIMARY KEY NOT NULL,\n\t\"playlistLimit\" integer DEFAULT 50 NOT NULL,\n\t\"secondsToWaitAfterQueueEmpties\" integer DEFAULT 30 NOT NULL,\n\t\"leaveIfNoListeners\" boolean DEFAULT true NOT NULL,\n\t\"queueAddResponseEphemeral\" boolean DEFAULT false NOT NULL,\n\t\"autoAnnounceNextSong\" boolean DEFAULT false NOT NULL,\n\t\"defaultVolume\" integer DEFAULT 100 NOT NULL,\n\t\"defaultQueuePageSize\" integer DEFAULT 10 NOT NULL,\n\t\"turnDownVolumeWhenPeopleSpeak\" boolean DEFAULT false NOT NULL,\n\t\"turnDownVolumeWhenPeopleSpeakTarget\" integer DEFAULT 20 NOT NULL,\n\t\"createdAt\" timestamp DEFAULT now() NOT NULL,\n\t\"updatedAt\" timestamp DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE \"user\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"name\" text,\n\t\"email\" text,\n\t\"emailVerified\" timestamp,\n\t\"image\" text,\n\t\"createdAt\" timestamp DEFAULT now() NOT NULL,\n\t\"updatedAt\" timestamp DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE \"verificationToken\" (\n\t\"identifier\" text NOT NULL,\n\t\"token\" text NOT NULL,\n\t\"expires\" timestamp NOT NULL,\n\tCONSTRAINT \"verificationToken_identifier_token_pk\" PRIMARY KEY(\"identifier\",\"token\")\n);\n--> statement-breakpoint\nALTER TABLE \"account\" ADD CONSTRAINT \"account_userId_user_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE \"discord_user\" ADD CONSTRAINT \"discord_user_userId_user_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE \"guild_member\" ADD CONSTRAINT \"guild_member_guildId_discord_guild_id_fk\" FOREIGN KEY (\"guildId\") REFERENCES \"public\".\"discord_guild\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE \"guild_member\" ADD CONSTRAINT \"guild_member_userId_discord_user_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"discord_user\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE \"session\" ADD CONSTRAINT \"session_userId_user_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE \"setting\" ADD CONSTRAINT \"setting_guildId_discord_guild_id_fk\" FOREIGN KEY (\"guildId\") REFERENCES \"public\".\"discord_guild\"(\"id\") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nCREATE INDEX \"account_user_id_idx\" ON \"account\" USING btree (\"userId\");--> statement-breakpoint\nCREATE INDEX \"discord_user_user_id_idx\" ON \"discord_user\" USING btree (\"userId\");--> statement-breakpoint\nCREATE INDEX \"guild_member_guild_id_idx\" ON \"guild_member\" USING btree (\"guildId\");--> statement-breakpoint\nCREATE INDEX \"guild_member_user_id_idx\" ON \"guild_member\" USING btree (\"userId\");--> statement-breakpoint\nCREATE INDEX \"guild_member_composite_idx\" ON \"guild_member\" USING btree (\"guildId\",\"userId\");--> statement-breakpoint\nCREATE INDEX \"session_user_id_idx\" ON \"session\" USING btree (\"userId\");",
    "web/index.html": "<!doctype html>\n<!-- File: index.html -->\n\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <link rel=\"icon\" type=\"image/svg+xml\" href=\"/vite.svg\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>ISOBEL - Discord Music Bot</title>\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script type=\"module\" src=\"/src/main.tsx\"></script>\n  </body>\n</html>\n",
    ".env.sample": "# File: .env.sample\n\nDISCORD_TOKEN=\nDATA_DIR=./data\n\n\n\n\n############\n# Optional #\n############\n\nCACHE_LIMIT=2GB\n\n# Health check server port\n# HEALTH_PORT=3002\n\n# ENABLE_SPONSORBLOCK=true\n# SPONSORBLOCK_TIMEOUT=5    # Delay (in mn) before retrying when SponsorBlock server are unreachable.\n\n# See the README for details on the below variables\nBOT_STATUS=\"DEBUGGING\"\n# BOT_ACTIVITY_TYPE=\n# BOT_ACTIVITY_URL=\n# BOT_ACTIVITY=\n\n\n\n",
    ".eslintignore": "# Dependencies\nnode_modules/\n\n# Build output\ndist/\n\n# Web submodule (has its own linting)\nweb/\n\n# Data and logs\ndata/\nlogs/\n\n# Database migrations\nmigrations/\n\n# Git\n.git/\n\n# Config files\n*.config.js\n*.config.cjs\n*.config.mjs\n\n# Other generated/cache files\n*.d.ts\ncoverage/\n.cache/\n\n"
  }
}